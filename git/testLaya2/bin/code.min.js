var View=Laya.View;var Dialog=Laya.Dialog;var game;(function(game){var util;(function(util){class PubUtil{constructor(){}static GetTodayDateStr(){var date=new Date;return date.getFullYear()+""+(date.getMonth()+1)+""+date.getDate()}}util.PubUtil=PubUtil})(util=game.util||(game.util={}))})(game||(game={}));var game;(function(game){var util;(function(util){class ProxyUtil{constructor(){}static regProxy(target,propName,callBack){Object.defineProperty(target,propName,{get:()=>{return target[propName]},set:v=>{let old=target[propName];target[propName]=v;if(callBack){callBack(old,v)}}})}}util.ProxyUtil=ProxyUtil})(util=game.util||(game.util={}))})(game||(game={}));var game;(function(game){var util;(function(util){class MathUtil{constructor(){}static randomRange(min,max){return Math.floor(Math.random()*(max-min+1)+min)}static isOverlap(rect1,rect2){const startX1=rect1.x,startY1=rect1.y,endX1=startX1+rect1.width,endY1=startY1+rect1.height;const startX2=rect2.x,startY2=rect2.y,endX2=startX2+rect2.width,endY2=startY2+rect2.height;return!(endY2<startY1||endY1<startY2||startX1>endX2||startX2>endX1)}static angleToRadian(angle){return angle*Math.PI/180}static radianToAngle(radian){return radian*180/Math.PI}static changeAngle360(angle){if(angle%360<0){angle+=360}return angle}static CreateBezierPoints(anchorpoints,pointsAmount){var points=[];for(var i=0;i<pointsAmount;i++){var point=this.MultiPointBezier(anchorpoints,i/pointsAmount);points.push(point)}return points}static MultiPointBezier(points,t){let len=points.length;let x=0,y=0;for(let i=0;i<len;i++){let point=points[i];x+=point.x*Math.pow(1-t,len-1-i)*Math.pow(t,i)*this.erxiangshi(len-1,i);y+=point.y*Math.pow(1-t,len-1-i)*Math.pow(t,i)*this.erxiangshi(len-1,i)}return{x:x,y:y}}static erxiangshi(start,end){let cs=1,bcs=1;while(end>0){cs*=start;bcs*=end;start--;end--}return cs/bcs}static getDistance(p1,p2){let dx=p2.x-p1.x;let dy=p2.y-p1.y;let distance=Math.sqrt(dx*dx+dy*dy);return distance}}util.MathUtil=MathUtil})(util=game.util||(game.util={}))})(game||(game={}));var game;(function(game){var util;(function(util){class Dictionary{constructor(){this._container=new Object;this._length=0}get container(){return this._container}get length(){return this._length}add(key,value){if(!this.hasKey(key))this._length++;this._container[key]=value;return value}forEach(func){var boo;for(let i in this._container){boo=func(this._container[i]);if(!boo){return}}}forIn(func){for(let i in this._container){func(i)}}valueOf(){var values=[];for(let i in this._container){values.push(this._container[i])}return values}get(key){return this._container[key]}reset(key,value){if(this.hasKey(key)){this._container[key]=value}else{console.log("ObjDictionary: warning you reset a not exist key")}}hasKey(key){return this._container.hasOwnProperty(key)}remove(key){if(this._container.hasOwnProperty(key)){let value=this._container[key];this._container[key]=null;delete this._container[key];this._length--;return value}return null}clear(){this._length=0;this._container=null;this._container=new Object}}util.Dictionary=Dictionary})(util=game.util||(game.util={}))})(game||(game={}));var game;(function(game){var ui;(function(ui){class UIType{constructor(v,v2){this.name=v;this.path=v2}}ui.UIType=UIType})(ui=game.ui||(game.ui={}))})(game||(game={}));var game;(function(game){var ui;(function(ui){class UIScaleManager{constructor(){if(UIScaleManager._ins!=null)throw new Error("UIScaleManager is single!")}static get ins(){if(!this._ins)UIScaleManager._ins=new UIScaleManager;return this._ins}init(){this.dicWindow=new Dictionary;EventManager.ins.on(NoticeEvent.SYS_SCREEN_HORIZONTAL_ONSIZE,this,this.SYS_SCREEN_HORIZONTAL_ONSIZE);EventManager.ins.on(NoticeEvent.SYS_SCREEN_VERTICAL_ONSIZE,this,this.SYS_SCREEN_VERTICAL_ONSIZE);this.autoScale()}regUI(name,scaleH,scaleV){if(!this.dicWindow){console.error("UIScaleManager.ts 未进行初始化！");return}let arrFunc=this.dicWindow.get(name);if(!arrFunc){arrFunc=new Array;this.dicWindow.add(name,arrFunc)}arrFunc[0]=scaleH;arrFunc[1]=scaleV}autoScale(){if(game.Define.isVertitalState){this.SYS_SCREEN_VERTICAL_ONSIZE()}else{this.SYS_SCREEN_HORIZONTAL_ONSIZE()}}SYS_SCREEN_HORIZONTAL_ONSIZE(){for(let arrFunc of this.dicWindow.valueOf()){if(arrFunc){if(arrFunc[0]){arrFunc[0]()}}}}SYS_SCREEN_VERTICAL_ONSIZE(){for(let arrFunc of this.dicWindow.valueOf()){if(arrFunc){if(arrFunc[1]){arrFunc[1]()}}}}}ui.UIScaleManager=UIScaleManager})(ui=game.ui||(game.ui={}))})(game||(game={}));var game;(function(game){var ui;(function(ui){class UIManager{constructor(){if(UIManager._ins!=null)throw new Error("UIManager is single!")}static get ins(){if(!this._ins)UIManager._ins=new UIManager;return this._ins}init(){this.topView=LayerManager.ins.addChild(new Laya.Sprite,LayerName.ui_effect);this.topMask=new Laya.Sprite;this.topView.addChild(this.topMask);this.dicWindow=new Dictionary;ui.UIScaleManager.ins.init()}getWindow(uiType){var win=this.dicWindow.get(uiType.name);if(!win){var cls=uiType.path;win=new cls;win.uiType=uiType;this.dicWindow.add(uiType.name,win)}return win}openWindow(uiType){var win=this.getWindow(uiType);if(win.isOpen()){}else{LayerManager.ins.addChild(win.view,LayerName.ui_window);if(uiType.name=="gameDownload"){if(game.Global.platformId==PlatformID.Vg){if(parent){parent.postMessage("complete","*");console.log("vungle 调用 parent.postMessage('complete','*')")}}}}return win}closeWindow(uiType){var win=this.dicWindow.get(uiType.name);if(win){win.view.removeSelf()}}addFrameAnimation(frame,layer=LayerName.main){LayerManager.ins.addChild(frame,layer);return frame}removeFrameAnimation(frame){frame.removeSelf()}addTop(sp){this.topView.addChild(sp)}drawTopMask(size,alpha=.5){let topMask=this.topMask;if(!size){topMask.graphics.clear();return}let x=size.x;let y=size.y;let w=size.w;let h=size.h;topMask.graphics.drawRect(0,0,game.Define.DeviceW,y,"#000000");topMask.graphics.drawRect(0,y,x,h,"#000000");topMask.graphics.drawRect(x+w,y,game.Define.DeviceW-(x+w),h,"#000000");topMask.graphics.drawRect(0,y+h,game.Define.DeviceW,game.Define.DeviceH-(y+h),"#000000");topMask.alpha=alpha}addTopBtnSound(btnSound){if(!btnSound){return}LayerManager.ins.addChild(btnSound,LayerName.top);btnSound.on(Laya.Event.CLICK,this,()=>{if(btnSound.gray){btnSound.gray=false;SoundManager.ins.setOn(true)}else{btnSound.gray=true;SoundManager.ins.setOn(false)}})}}ui.UIManager=UIManager})(ui=game.ui||(game.ui={}))})(game||(game={}));var game;(function(game){var ui;(function(ui_1){class BaseUI{constructor(){this.dicInitPosition=new Dictionary}open(){}close(){}detory(){}recordInitPosition(ui){if(ui instanceof Laya.View){for(let i=0;i<ui.numChildren;i++){let child=ui.getChildAt(i);this.dicInitPosition.add(child.name,new Laya.Point(child.x,child.y))}}else{this.dicInitPosition.add(ui.name,new Laya.Point(ui.x,ui.y))}}getInitPosition(name){var point=this.dicInitPosition.get(name);if(!point){point=new Laya.Point}return point}getInitPositionOffX(sp1,sp2){if(!sp1||!sp2){return 0}let p1=this.getInitPosition(sp1.name);let p2=this.getInitPosition(sp2.name);return p2.x-p1.x}getInitPositionOffY(sp1,sp2){if(!sp1||!sp2){return 0}let p1=this.getInitPosition(sp1.name);let p2=this.getInitPosition(sp2.name);return p2.y-p1.y}resetInitPosition(sp){var point=this.dicInitPosition.get(sp.name);if(point){sp.x=point.x;sp.y=point.y}}setPositionByOffX(sp1,sp2){if(!sp1||!sp2){return}let offX=this.getInitPositionOffX(sp1,sp2);sp2.x=sp1.x+offX}setPositionByOffY(sp1,sp2){if(!sp1||!sp2){return}let offY=this.getInitPositionOffY(sp1,sp2);sp2.y=sp1.y+offY}}ui_1.BaseUI=BaseUI})(ui=game.ui||(game.ui={}))})(game||(game={}));var game;(function(game){var scene;(function(scene){class SceneManager{constructor(){this.lastClientWidth=0;this.isGameResLoaded=false;this.spBody=null;this.fillScale=.5;this.fillRate=0;this.fillRateLength=0;if(SceneManager._ins!=null)throw new Error("SceneManager is single!");this.imgDefault=new Laya.Image;scene.LayerManager.ins.addChild(this.imgDefault,scene.LayerName.scene_map)}static get ins(){if(!this._ins)SceneManager._ins=new SceneManager;return this._ins}init(){this.mapRoot=scene.LayerManager.ins.getLayer(scene.LayerName.scene_map);this.arrMap=[];KingManager.ins.init();BoneManager.ins.init();Laya.stage.on(Laya.Event.FOCUS,this,this.onFocus);Laya.stage.on(Laya.Event.BLUR,this,this.onBlur);Laya.stage.on(Laya.Event.RESIZE,this,this.onResize);Laya.stage.on(Laya.Event.VISIBILITY_CHANGE,this,SceneManager.ins.onVisibilityChange);EventManager.ins.on(NoticeEvent.GAME_RES_LOAD_FINISH,this,this.GAME_RES_LOAD_FINISH);this.initStage()}initStage(){EventManager.ins.on(NoticeEvent.SYS_SCREEN_HORIZONTAL,this,this.SCREEN_HORIZONTAL);EventManager.ins.on(NoticeEvent.SYS_SCREEN_VERTICAL,this,this.SCREEN_VERTICAL);EventManager.ins.on(NoticeEvent.SYS_SCREEN_HORIZONTAL_ONSIZE,this,this.SCREEN_HORIZONTAL_ONSIZE);EventManager.ins.on(NoticeEvent.SYS_SCREEN_VERTICAL_ONSIZE,this,this.SCREEN_VERTICAL);Laya.stage.screenMode=Stage.SCREEN_NONE;Laya.stage.scaleMode=Laya.Stage.SCALE_EXACTFIT;Laya.stage.alignH=Laya.Stage.ALIGN_CENTER;Laya.stage.alignV=Laya.Stage.ALIGN_MIDDLE;Laya.timer.frameLoop(1,this,()=>{if(this.lastClientWidth!=Laya.Browser.clientWidth){if(Laya.Browser.clientWidth>Laya.Browser.clientHeight){console.log("横屏",this.lastClientWidth);game.Define.isVertitalState=false;EventManager.ins.event(NoticeEvent.SYS_SCREEN_HORIZONTAL)}else{console.log("竖屏",this.lastClientWidth);game.Define.isVertitalState=true;EventManager.ins.event(NoticeEvent.SYS_SCREEN_VERTICAL)}this.lastClientWidth=Laya.Browser.clientWidth}})}onResize(){if(Laya.Browser.clientWidth>Laya.Browser.clientHeight){EventManager.ins.event(NoticeEvent.SYS_SCREEN_HORIZONTAL_ONSIZE)}else{EventManager.ins.event(NoticeEvent.SYS_SCREEN_VERTICAL_ONSIZE)}}onFocus(e){console.log("获得焦点");EventManager.ins.event(NoticeEvent.SYS_FOCUS,e);Laya.stage.timer.once(200,this,()=>{SoundManager.ins.playMusic(game.Define.SOUND_MAIN)})}onBlur(e){console.log("失去焦点");EventManager.ins.event(NoticeEvent.SYS_BLUR,e)}onVisibilityChange(e){console.log("舞台是否可见："+Laya.stage.isVisibility);if(Laya.stage.isVisibility){this.onFocus(e)}else{this.onBlur(e)}}GAME_RES_LOAD_FINISH(e){Laya.stage.bgColor=game.Define.BACKGROUND_COLOR;this.isGameResLoaded=true;this.fill()}SCREEN_HORIZONTAL(){this.fillRate=Laya.Browser.clientWidth/game.Define.DeviceW/(Laya.Browser.clientHeight/game.Define.DeviceH);var div=document.getElementById("h_div");if(div){div.style.display=""}if(this.spBody){this.spBody.visible=true}else{this.fill()}if(game.Define.isVertitalGame){scene.LayerManager.ins.setScale(.5)}else{scene.LayerManager.ins.setScale(1)}this.fillRateLength=game.Define.DeviceH/(this.fillRate*this.fillScale)}SCREEN_VERTICAL(){this.fillRate=Laya.Browser.clientWidth/game.Define.DeviceW/(Laya.Browser.clientHeight/game.Define.DeviceH);var div=document.getElementById("h_div");if(div){div.style.display="none"}if(this.spBody){this.spBody.visible=false}if(game.Define.isVertitalGame){scene.LayerManager.ins.setScale(1)}else{scene.LayerManager.ins.setScale(.5)}this.fillRateLength=game.Define.DeviceW/(this.fillRate*this.fillScale)}SCREEN_HORIZONTAL_ONSIZE(){}fill(){if(!this.isGameResLoaded||Laya.Browser.clientWidth<Laya.Browser.clientHeight){return}if(!this.spBody){this.spBody=new Laya.Sprite;scene.LayerManager.ins.addChild(this.spBody,scene.LayerName.root);this.spBody.graphics.drawRect(0,0,game.Define.DeviceW>>2,game.Define.DeviceH,game.Define.BACKGROUND_COLOR);this.spBody.graphics.drawRect(game.Define.DeviceW*.75,0,game.Define.DeviceW>>2,game.Define.DeviceH,game.Define.BACKGROUND_COLOR);if(game.Define.screenFillType==ScreenFillType.simple){this.fillSimple()}else if(game.Define.screenFillType==ScreenFillType.nice1){this.fillNice1()}else if(game.Define.screenFillType==ScreenFillType.nice2){this.fillNice2()}else{}this.onResize()}}fillSimple(){let scaleX=0;let scaleY=0;let imgLogo=this.createLogo();let imgDownload=this.createDownload();imgDownload.x=imgLogo.x;imgDownload.y=game.Define.DeviceH-imgDownload.height*scaleY-50}fillNice1(){let scaleX=0;let scaleY=0;if(Laya.loader.getRes("game/img_nice.png")){let imgNice=new Laya.Image;imgNice.skin="game/img_nice.png";scaleX=game.Define.DeviceW/5/imgNice.width;scaleY=scaleX*this.fillRate;imgNice.scaleX=scaleX;imgNice.scaleY=scaleY;imgNice.x=game.Define.DeviceW/40;imgNice.y=game.Define.DeviceH-imgNice.height*scaleY;this.spBody.addChild(imgNice);imgNice=new Laya.Image;imgNice.skin="game/img_nice.png";imgNice.scaleX=scaleX;imgNice.scaleY=scaleY;imgNice.x=game.Define.DeviceW*.75+game.Define.DeviceW/40;imgNice.y=game.Define.DeviceH-imgNice.height*scaleY;this.spBody.addChild(imgNice)}let imgLogo=this.createLogo();let imgDownload=this.createDownload();imgDownload.x=imgLogo.x;imgDownload.y=game.Define.DeviceH-imgDownload.height*imgDownload.scaleY-50;if(game.Define.langId==LangType.En&&Laya.loader.getRes("game/btn_download2.png")||game.Define.langId==LangType.Zh&&Laya.loader.getRes("game/btn_download2_zh.png")){imgDownload=this.createDownload("2");imgDownload.x=game.Define.DeviceW*.75+game.Define.DeviceW/40;imgDownload.y=game.Define.DeviceH-imgDownload.height*imgDownload.scaleY-50}}fillNice2(){let scaleX=0;let scaleY=0;if(Laya.loader.getRes("game/img_nice.png")){let imgNice=new Laya.Image;imgNice.skin="game/img_nice.png";scaleX=.7;imgNice.scaleX=scaleX;imgNice.x=imgNice.width*(1-scaleX)/2;imgNice.y=0;this.spBody.addChild(imgNice);imgNice=new Laya.Image;imgNice.skin="game/img_nice.png";imgNice.scaleX=scaleX;imgNice.x=game.Define.DeviceW*.75+imgNice.width*(1-scaleX)/2;imgNice.y=0;this.spBody.addChild(imgNice)}let imgLogo=this.createLogo();imgLogo.y=(game.Define.DeviceH>>1)-imgLogo.height*imgLogo.scaleY/2;let imgDownload=this.createDownload();imgDownload.x=game.Define.DeviceW*.75+game.Define.DeviceW/40;imgDownload.y=(game.Define.DeviceH>>1)-imgDownload.height*imgDownload.scaleY/2}createLogo(){let scaleX=0;let scaleY=0;let imgLogo=new Laya.Image;imgLogo.skin=game.Define.langId==LangType.En?"loading/img_logo.png":"loading/img_logo.png";scaleX=game.Define.DeviceW/5/imgLogo.width;scaleY=scaleX*this.fillRate;imgLogo.scaleX=scaleX;imgLogo.scaleY=scaleY;imgLogo.x=game.Define.DeviceW/40;imgLogo.y=0;this.spBody.addChild(imgLogo);return imgLogo}createDownload(right=""){let scaleX=0;let scaleY=0;let imgDownload=new Laya.Image;imgDownload.skin=game.Define.langId==LangType.En?"game/btn_download"+right+".png":"game/btn_download"+right+"_zh.png";scaleX=game.Define.DeviceW/5/imgDownload.width;scaleY=scaleX*this.fillRate;imgDownload.scaleX=scaleX;imgDownload.scaleY=scaleY;imgDownload.x=game.Define.DeviceW/40;imgDownload.y=0;this.spBody.addChild(imgDownload);imgDownload.mouseEnabled=true;imgDownload.on(Laya.Event.CLICK,this,()=>{HttpManager.ins.link(game.Define.DOWNLOAD_URL)});return imgDownload}setBackground(url,x=0,y=0,w=-1,h=-1){if(x>0||y>0||w>0||h>0){let map=new Laya.Image;map.x=x;map.y=y;if(w!=-1)map.width=w;if(h!=-1)map.height=h;Base64Manager.ins.checkImg(map,url);scene.LayerManager.ins.addChild(map,scene.LayerName.scene_map);this.arrMap.push(map)}else{Base64Manager.ins.checkImg(this.imgDefault,url)}}clearMapAll(){for(let map of this.arrMap){map.removeSelf()}while(this.mapRoot.numChildren>0){this.mapRoot.getChildAt(0).removeSelf()}this.mapRoot.addChild(this.imgDefault)}}scene.SceneManager=SceneManager;let ScreenFillType;(function(ScreenFillType){ScreenFillType[ScreenFillType["default"]=0]="default";ScreenFillType[ScreenFillType["simple"]=1]="simple";ScreenFillType[ScreenFillType["nice1"]=2]="nice1";ScreenFillType[ScreenFillType["nice2"]=3]="nice2"})(ScreenFillType=scene.ScreenFillType||(scene.ScreenFillType={}))})(scene=game.scene||(game.scene={}))})(game||(game={}));var game;(function(game){var scene;(function(scene_1){class Scene3DManager{constructor(){this.debugSprites=new Array;if(Scene3DManager._ins!=null)throw new Error("Scene3DManager is single!")}static get ins(){if(!this._ins)Scene3DManager._ins=new Scene3DManager;return this._ins}init(scene=null){if(scene){this._scene3d=scene_1.LayerManager.ins.addChild(scene,scene_1.LayerName.scene_king);this._camera=scene.getChildByName("Main Camera");this._camera.aspectRatio=game.Define.DeviceW/game.Define.DeviceH;this._light=scene.getChildByName("Directional Light");console.log("使用Unity摄像机：",this._scene3d,this._camera,this._light)}else{this._scene3d=scene_1.LayerManager.ins.addChild(new Laya.Scene3D,scene_1.LayerName.scene_king);this._camera=this._scene3d.addChild(new Laya.Camera(game.Define.DeviceW/game.Define.DeviceH,.1,1e3));this._camera.transform.translate(new Laya.Vector3(0,10,1));this._camera.transform.rotate(new Laya.Vector3(-5,0,0),true,false);this._camera.clearFlag=Laya.BaseCamera.CLEARFLAG_NONE;this._light=this._scene3d.addChild(new Laya.DirectionLight);this._light.diffuseColor=new Laya.Vector3(.6,.6,.6);let mat=this._light.transform.worldMatrix;mat.setForward(new Laya.Vector3(-1,-1,-1));this._light.transform.worldMatrix=mat}}get scene3D(){if(!this._scene3d){console.error("Scene3DManager 未进行初始化!")}return this._scene3d}get camera(){if(!this._camera){console.error("Scene3DManager 未进行初始化!")}return this._camera}get light(){if(!this._light){console.error("Scene3DManager 未进行初始化!")}return this._light}drawRayLine(from,to){if(this.debugSprites.length>0){for(let i=0,n=this.debugSprites.length;i<n;i++)this.debugSprites[i].destroy();this.debugSprites.length=0}var lineSprite=this._scene3d.addChild(new Laya.PixelLineSprite3D(1));lineSprite.addLine(from,to,Laya.Color.RED,Laya.Color.RED);this.debugSprites.push(lineSprite)}addBox(){}addSphere(){}addCapsule(){}addCone(){}addCylinder(){}}scene_1.Scene3DManager=Scene3DManager})(scene=game.scene||(game.scene={}))})(game||(game={}));var game;(function(game){var scene;(function(scene){class LayerManager{constructor(){if(LayerManager._ins!=null)throw new Error("LayerManager is single!")}static get ins(){if(!this._ins)LayerManager._ins=new LayerManager;return this._ins}init(){game.Global.uiRoot=Laya.stage.addChild(new Laya.Sprite);this.dicLayer=new Dictionary;this.dicLayer.add(LayerName.root,game.Global.uiRoot);this.dicLayer.add(LayerName.scene,game.Global.uiRoot.addChild(new Laya.Sprite));this.dicLayer.add(LayerName.main,game.Global.uiRoot.addChild(new Laya.Sprite));this.dicLayer.add(LayerName.ui,game.Global.uiRoot.addChild(new Laya.Sprite));this.dicLayer.add(LayerName.top,game.Global.uiRoot.addChild(new Laya.Sprite));this.dicLayer.add(LayerName.scene_map,this.dicLayer.get(LayerName.scene).addChild(new Laya.Sprite));this.dicLayer.add(LayerName.scene_king,this.dicLayer.get(LayerName.scene).addChild(new Laya.Sprite));this.dicLayer.add(LayerName.scene_effect,this.dicLayer.get(LayerName.scene).addChild(new Laya.Sprite));this.dicLayer.add(LayerName.ui_window,this.dicLayer.get(LayerName.ui).addChild(new Laya.Sprite));this.dicLayer.add(LayerName.ui_effect,this.dicLayer.get(LayerName.ui).addChild(new Laya.Sprite))}setScale(scale=1){scene.SceneManager.ins.fillScale=scale;if(game.Define.isVertitalGame){this.getLayer(LayerName.scene_king).scaleX=scale;this.getLayer(LayerName.scene_effect).scaleX=scale;this.getLayer(LayerName.main).scaleX=scale;this.getLayer(LayerName.ui).scaleX=scale;this.getLayer(LayerName.top).scaleX=scale;this.getLayer(LayerName.scene_king).x=(1-scale)*game.Define.DeviceW>>1;this.getLayer(LayerName.scene_effect).x=(1-scale)*game.Define.DeviceW>>1;this.getLayer(LayerName.main).x=(1-scale)*game.Define.DeviceW>>1;this.getLayer(LayerName.ui).x=(1-scale)*game.Define.DeviceW>>1;this.getLayer(LayerName.top).x=(1-scale)*game.Define.DeviceW>>1;if(game.Define.screenFillType!=scene.ScreenFillType.default){this.getLayer(LayerName.scene_map).scaleX=scale;this.getLayer(LayerName.scene_map).x=(1-scale)*game.Define.DeviceW>>1}if(game.Define.isSameScale){if(scale==1){this.getLayer(LayerName.scene_map).scaleY=1;this.getLayer(LayerName.scene_king).scaleY=1;this.getLayer(LayerName.scene_effect).scaleY=1;this.getLayer(LayerName.main).scaleY=1;this.getLayer(LayerName.ui).scaleY=1;this.getLayer(LayerName.top).scaleY=1;let camera=scene.Scene3DManager.ins.camera;if(camera){camera.aspectRatio=game.Define.DeviceW/game.Define.DeviceH}}else{let rate=scene.SceneManager.ins.fillRate;if(game.Define.isSameBackgroundScale){this.getLayer(LayerName.scene_map).scaleY=scale*rate}this.getLayer(LayerName.scene_king).scaleY=scale*rate;this.getLayer(LayerName.scene_effect).scaleY=scale*rate;this.getLayer(LayerName.main).scaleY=scale*rate;this.getLayer(LayerName.ui).scaleY=scale*rate;this.getLayer(LayerName.top).scaleY=scale*rate;let camera=scene.Scene3DManager.ins.camera;if(camera){camera.aspectRatio=scale*rate}}}}else{}}setScaleY(rate=0){if(rate!=1){this.getLayer(LayerName.scene).scaleY*=rate;this.getLayer(LayerName.main).scaleY*=rate;this.getLayer(LayerName.ui).scaleY*=rate;this.getLayer(LayerName.top).scaleY*=rate}else{this.getLayer(LayerName.scene).scaleY=1;this.getLayer(LayerName.main).scaleY=1;this.getLayer(LayerName.ui).scaleY=1;this.getLayer(LayerName.top).scaleY=1}}addChild(child,layerNum=LayerName.root){if(layerNum==LayerName.root){return game.Global.uiRoot.addChild(child)}else{return this.dicLayer.get(layerNum).addChild(child)}}removeChild(child,layerNum=LayerName.root){if(layerNum==LayerName.root){return game.Global.uiRoot.removeChild(child)}else{return this.dicLayer.get(layerNum).removeChild(child)}}removeLayerAllChild(layerNum){if(layerNum==LayerName.root){game.Global.uiRoot.removeChildren(4)}else{this.dicLayer.get(layerNum).removeChildren()}}getLayer(layerNum=LayerName.root){if(layerNum==LayerName.root){return game.Global.uiRoot}else{return this.dicLayer.get(layerNum)}}createBodyDiv(){}}scene.LayerManager=LayerManager;let LayerName;(function(LayerName){LayerName[LayerName["root"]=0]="root";LayerName[LayerName["scene"]=1]="scene";LayerName[LayerName["scene_map"]=2]="scene_map";LayerName[LayerName["scene_king"]=3]="scene_king";LayerName[LayerName["scene_effect"]=4]="scene_effect";LayerName[LayerName["main"]=5]="main";LayerName[LayerName["ui"]=6]="ui";LayerName[LayerName["ui_window"]=7]="ui_window";LayerName[LayerName["ui_effect"]=8]="ui_effect";LayerName[LayerName["top"]=9]="top"})(LayerName=scene.LayerName||(scene.LayerName={}))})(scene=game.scene||(game.scene={}))})(game||(game={}));var game;(function(game){var net;(function(net){class NetManager{constructor(){if(NetManager._ins!=null)throw new Error("NetManager is single!");NetManager._ins=this;this._socketDataEvent=new Dictionary}static get ins(){if(!this._ins)new NetManager;return this._ins}init(){console.log("serverIP",game.Define.serverIP,"serverPort",game.Define.serverPort);this.socket=io.connect(game.Define.serverIP+":"+game.Define.serverPort);this.socket.on(SocketIoEvent.message,this,this.onMessageReveived);this.socket.on(SocketIoEvent.connect,this,this.onSocketOpen);this.socket.on(SocketIoEvent.disconnect,this,this.onSocketClose);this.socket.on(SocketIoEvent.error,this,this.onConnectError)}onSocketOpen(e=null){console.log("与服务器连接成功");EventManager.ins.event(SocketIoEvent.connect,e)}onSocketClose(e=null){console.log("与服务器连接断开");EventManager.ins.event(SocketIoEvent.disconnect,e)}onMessageReveived(message=null){console.log("收到服务端message");if(message){console.log(message)}else if(message){console.log(new Laya.Byte(message).readUTFBytes())}EventManager.ins.event(SocketIoEvent.message,message)}onConnectError(e=null){console.log("error");EventManager.ins.event(SocketIoEvent.error,e)}send(data,fn){if(!this.socket){console.error("NetManager 未初始化！");return}this.socket.send(data)}emit(eventName,...args){if(!this.socket){console.error("NetManager 未初始化！");return}}registerNetEvent(eventName,_callback){if(this._socketDataEvent.hasKey(eventName)){this._socketDataEvent.get(eventName).push(_callback)}else{this._socketDataEvent.add(eventName,[_callback])}this.socket.on(eventName,this,_callback.method.bind(_callback.caller))}unregisterNetEvent(eventName,_callback){if(this._socketDataEvent.hasKey(eventName)){let arr=this._socketDataEvent.get(eventName);if(arr.indexOf(_callback)>=0){arr.splice(arr.indexOf(_callback))}}}update(){while(this._socketDataEvent.length>0){}}}net.NetManager=NetManager;class SocketIoEvent{}SocketIoEvent.connect="connect";SocketIoEvent.connect_error="connect_error";SocketIoEvent.connect_timeout="connect_timeout";SocketIoEvent.reconnect="reconnect";SocketIoEvent.disconnect="disconnect";SocketIoEvent.error="error";SocketIoEvent.message="message";net.SocketIoEvent=SocketIoEvent})(net=game.net||(game.net={}))})(game||(game={}));var game;(function(game){var net;(function(net){class HttpManager{constructor(){if(HttpManager._ins!=null)throw new Error("HttpManager is single!");this.xhr=new Laya.HttpRequest;this.xhr.http.timeout=5e4;this.xhr.on(Laya.Event.PROGRESS,this,this.onHttpRequestProgress)}static get ins(){if(!this._ins)HttpManager._ins=new HttpManager;return this._ins}link(url){console.log("link-url:",url);switch(game.Global.platformId){case PlatformID.Wx:case PlatformID.None:Laya.Browser.window.location.href=url;break;case PlatformID.Al:if(PlatformManager.mraid){console.log("调用 mraid.open");PlatformManager.mraid.open(url)}else{TipManager.ins.showWord("Applovin does not support mraid!");Laya.Browser.window.location.href=url}break;case PlatformID.Is:if(PlatformManager.mraid){console.log("调用 mraid.openStoreUrl");PlatformManager.ins.actionCallBack(PlatformAction.DownLoad);PlatformManager.mraid.openStoreUrl(url)}else{TipManager.ins.showWord("IronSource does not support mraid!");Laya.Browser.window.location.href=url}break;case PlatformID.Ut:if(PlatformManager.mraid){console.log("调用 mraid.open");PlatformManager.mraid.open(url)}else{TipManager.ins.showWord("Unity does not support mraid!");Laya.Browser.window.location.href=url}break;case PlatformID.Gg:if(Laya.Browser.window.ExitApi){Laya.Browser.window.ExitApi.exit()}if(PlatformManager.mraid){console.log("调用 mraid.open");PlatformManager.mraid.open(url)}else{Laya.Browser.window.location.href=url}break;case PlatformID.Fb:if(PlatformManager.mraid){console.log("调用 mraid.open");Laya.Browser.window.FbPlayableAd.onCTAClick()}else{TipManager.ins.showWord("facebook does not support FbPlayableAd!");Laya.Browser.window.location.href=url}break;case PlatformID.Vg:if(parent){console.log("调用 parent.postMessage('download','*')");parent.postMessage("download","*")}else{TipManager.ins.showWord("vungle does not support parent.postMessage!");Laya.Browser.window.location.href=url}break;case PlatformID.Ac:if(PlatformManager.mraid){console.log("调用 mraid.open");PlatformManager.mraid.open(url)}else{TipManager.ins.showWord("adcolony does not support mraid!");Laya.Browser.window.location.href=url}break;case PlatformID.mtg:PlatformManager.ins.actionCallBack(PlatformAction.DownLoad);break;default:break}}get(url,caller,callback){this.caller=caller;this.callback=callback;this.xhr.once(Laya.Event.COMPLETE,this,this.onHttpRequestComplete);this.xhr.once(Laya.Event.ERROR,this,this.onHttpRequestError);this.xhr.send(url,null,"get","text");return this}post(url,data,contentType,caller,callback){this.caller=caller;this.callback=callback;this.xhr.once(Laya.Event.COMPLETE,this,this.onHttpRequestComplete);this.xhr.once(Laya.Event.ERROR,this,this.onHttpRequestError);if(contentType==null){this.xhr.send(url,data,"post","text")}else{this.xhr.send(url,data,"post","text",["content-type",contentType])}return this}onHttpRequestProgress(e){console.log("onHttpRequestProgress"+e);EventManager.ins.event(NoticeEvent.HTTP_PROGRESS,e)}onHttpRequestError(e){console.log("onHttpRequestError");this.callback.apply(this.caller,[{state:500,msg:e}])}onHttpRequestComplete(e){this.callback.apply(this.caller,[{state:200,data:this.xhr.data}])}}net.HttpManager=HttpManager})(net=game.net||(game.net={}))})(game||(game={}));var game;(function(game){var king;(function(king_1){class KingManager{constructor(){if(KingManager._ins!=null)throw new Error("KingManager is single!")}static get ins(){if(!this._ins)KingManager._ins=new KingManager;return this._ins}init(){this.dicWindow=new Dictionary}addKing(king){LayerManager.ins.addChild(king,LayerName.scene_king);return king}removeKing(king){king.removeSelf()}}king_1.KingManager=KingManager})(king=game.king||(game.king={}))})(game||(game={}));var game;(function(game){var king;(function(king){var Templet=Laya.Templet;class BoneManager{constructor(){this.boneIndex=1e4;if(BoneManager._ins!=null)throw new Error("BoneManager is single!")}static get ins(){if(!this._ins)BoneManager._ins=new BoneManager;return this._ins}init(){this.dicTemp=new Dictionary;this.dicBonePool=new Dictionary;this.dicBone=new Dictionary}addBone(base64Type,isAutoPlay=true,isLoop=false,layerName=null){let temp=null;if(this.dicTemp.hasKey(base64Type.name)){temp=this.dicTemp.get(base64Type.name)}else{temp=new Templet;this.dicTemp.add(base64Type.name,temp)}let bone=null;let objId=0;if(temp.isParserComplete){bone=this.createBone(base64Type.name,base64Type.paramNum,isAutoPlay,isLoop,layerName)}else{bone=new king.BaseBone(base64Type.name,base64Type.paramNum,isAutoPlay,isLoop,layerName);if(temp.hasListener(Laya.Event.COMPLETE)){return bone}if(Base64Manager.isUseBase64){Laya.loader.cacheRes(base64Type.id,Base64Manager.ins.base64ToUint8Array(base64Type.base64Json))}temp.on(Laya.Event.COMPLETE,this,this.parseComplete,[base64Type.name]);temp.on(Laya.Event.ERROR,this,this.onError,[base64Type.paramNum]);temp.loadAni(base64Type.id)}return bone}onError(err){console.log("error",err)}parseComplete(data){console.log("spine动画模板："+data+" 加载完成！");EventManager.ins.event(NoticeEvent.BONE_TEMP_LOAD_FINISH,data)}createBone(boneName,cacheType=0,isAutoPlay=true,isLoop=true,layerName=null){let objId=0;let bone=null;if(this.dicBonePool.hasKey(boneName)){let arrSk=this.dicBonePool.get(boneName);if(arrSk&&arrSk.length>0){bone=arrSk.shift();console.log("从缓存池取出："+boneName+" 取出后还剩："+arrSk.length)}}if(!bone){bone=new king.BaseBone(boneName,cacheType,isAutoPlay,isLoop,layerName)}LayerManager.ins.addChild(bone,LayerName.scene_king);return bone}getTemp(boneName){if(this.dicTemp.hasKey(boneName)){return this.dicTemp.get(boneName)}return null}getBone(objId){if(this.dicBone.hasKey(objId)){return this.dicBone.get(objId)}return null}removeBone(bone){if(!bone){return}if(bone.parent){bone.removeSelf()}if(this.dicBone.hasKey(bone.objId)){this.dicBone.remove(bone.objId)}let arrSk=null;if(this.dicBonePool.hasKey(bone.kingType)){arrSk=this.dicBonePool.get(bone.kingType)}else{arrSk=new Array;this.dicBonePool.add(bone.kingType,arrSk)}if(arrSk){arrSk.push(bone)}}removeBoneAll(){for(let bone of this.dicBone.valueOf()){this.removeBone(bone)}}}king.BoneManager=BoneManager})(king=game.king||(game.king={}))})(game||(game={}));var game;(function(game){var effect;(function(effect){class EffectManager{constructor(){if(EffectManager._ins!=null)throw new Error("EffectManager is single!")}static get ins(){if(!this._ins)EffectManager._ins=new EffectManager;return this._ins}init(){this.topWindow=LayerManager.ins.addChild(new Laya.Sprite,LayerName.ui_effect);this.topScene=LayerManager.ins.addChild(new Laya.Sprite,LayerName.scene_effect)}getEffect(en,arrSprite,arrNumber=null,arrString=null,isScene=true){let be=null;switch(en){case EffectName.boss_warning:be=new effect.BossWarningEft(isScene);break;case EffectName.guide_click:be=new effect.GuideClickEft(isScene);break;case EffectName.Fountain:be=new effect.FountainEft(isScene);break;case EffectName.change_img:be=new effect.ChangeImageEft(isScene);break;default:console.error("EffectName not exist!");break}if(be)be.setData(arrSprite,arrNumber,arrString);return be}addEffect(be,isScene){if(isScene){this.topScene.addChild(be)}else{this.topWindow.addChild(be)}}}effect.EffectManager=EffectManager;let EffectName;(function(EffectName){EffectName[EffectName["boss_warning"]=0]="boss_warning";EffectName[EffectName["guide_click"]=1]="guide_click";EffectName[EffectName["Fountain"]=2]="Fountain";EffectName[EffectName["change_img"]=3]="change_img"})(EffectName=effect.EffectName||(effect.EffectName={}))})(effect=game.effect||(game.effect={}))})(game||(game={}));var game;(function(game){var common;(function(common){class TweenManager{constructor(){if(TweenManager._ins!=null)throw new Error("TweenManager is single!");this.dicTween=new Dictionary}static get ins(){if(!this._ins)TweenManager._ins=new TweenManager;return this._ins}regTween(tt){this.dicTween.add(tt.id,tt)}play(loop,name){let tt=this.dicTween.get(name);if(tt){tt.play(loop)}}stop(name,isHide=true){let tt=this.dicTween.get(name);if(tt){tt.stop(isHide)}}clearAll(){for(let tt of this.dicTween.valueOf()){if(tt){tt.stop();Laya.timer.clearAll(tt)}}}creatProp(tpt,param=null){let ret=[];switch(tpt){case TweenPropType.PING_PANG:if(!param||param.length==0){param=[30,200]}ret=[new TweenProp(param[1],0,0,1,param[0]),new TweenProp(param[1]*.75,0,0,1,-param[0]),new TweenProp(param[1]*.75,0,0,1,param[0]),new TweenProp(param[1]*.5,0,0,1,-(param[0]>>1)),new TweenProp(param[1]*.5,0,0,1,param[0]>>2),new TweenProp(param[1]*.4,0,0,1,0)];break;case TweenPropType.PING_PANG_1:if(!param||param.length==0){param=[100,200]}ret=[new TweenProp(param[1],0,0),new TweenProp(param[1]*.75,0,-param[0]),new TweenProp(param[1]*.75,0,param[0]),new TweenProp(param[1]*.5,0,-(param[0]>>1)),new TweenProp(param[1]*.5,0,param[0]>>2),new TweenProp(param[1]*.4,0,0)];break;case TweenPropType.PING_PANG_2:if(!param||param.length==0){param=[100,200]}ret=[new TweenProp(param[1],0,0),new TweenProp(param[1]*.75,0,-param[0]),new TweenProp(param[1]*.75,0,param[0]),new TweenProp(param[1]*.5,0,param[0]>>1),new TweenProp(param[1]*.5,0,param[0]>>2),new TweenProp(param[1]*.4,0,0)];break;case TweenPropType.GUIDE_SLID_1:if(!param||param.length<2){console.error("缓动横向滑动参数错误：必须是2个参数！")}else{ret=[new TweenProp(param[0],0,0,1),new TweenProp(0,param[1],0,1),new TweenProp(0,0,0,0)]}break;case TweenPropType.GUIDE_SLID_2:if(!param||param.length<2){console.error("缓动竖向滑动参数错误：必须是2个参数！")}else{ret=[new TweenProp(param[0],0,0,1),new TweenProp(0,0,param[1],1),new TweenProp(0,0,0,0)]}break;case TweenPropType.GUIDE_CLICK:if(!param||param.length==0){param=[20]}ret=[new TweenProp(100,0,param[0]),new TweenProp(100,0,param[0]>>1),new TweenProp(100,0,param[0]),new TweenProp(100,0,param[0]),new TweenProp(80,0,0)];break;case TweenPropType.LIGHT_STAR:if(!param||param.length==0){param=[100]}ret=[new TweenProp(100,0,0,1),new TweenProp(150,0,0,1),new TweenProp(0,0,0,0),new TweenProp(100,0,0,1),new TweenProp(150,0,0,1),new TweenProp(0,0,-1,0)];break;case TweenPropType.SMALL_BIG:if(!param||param.length<4){param=[1,1.5,1e3,1e3]}ret=[new TweenProp(param[3],0,0,1,0,param[0],param[0]),new TweenProp(param[2],0,0,1,0,param[1],param[1]),new TweenProp(param[3],0,0,1,0,param[0],param[0])];break;default:break}return ret}resetTarget(name,target){let tt=this.dicTween.get(name);if(tt){tt.stop();tt.resetTarget(target);tt.play(tt.isLoop)}}resetTargetPos(name,x,y){let tt=this.dicTween.get(name);if(tt){tt.stop();tt.target.x=x;tt.target.y=y;tt.resetTarget(tt.target);tt.play(tt.isLoop)}}resetProp(name,arrProp=null,delayTime=-1){let tt=this.dicTween.get(name);if(tt){tt.resetProp(arrProp,delayTime)}}resetPropByType(name,tpt,param=null,delayTime=-1){let tt=this.dicTween.get(name);if(tt){let arrProp=this.creatProp(tpt,param);tt.resetProp(arrProp,delayTime)}}}common.TweenManager=TweenManager;class TweenTarget{constructor(id,target,arrProp,delayTime,callBack=null){this.id="";this.delayTime=0;this.callBack=null;this.isLoop=true;this.propIndex=0;this.isPlay=true;this.curProp=null;this.targetX=0;this.targetY=0;this.id=id;this.resetTarget(target);this.arrProp=arrProp;this.delayTime=delayTime;this.callBack=callBack;this.curProp=new TweenProp(0)}play(isLoop=true){this.target.visible=true;Laya.Tween.clearAll(this.target);this.isLoop=isLoop;this.isPlay=true;this.propIndex=0;this.playNext()}playNext(){if(!this.isPlay){return}let propFrom=this.arrProp[this.propIndex++];let propTo=null;if(this.propIndex<this.arrProp.length){propTo=this.arrProp[this.propIndex];this.curProp.x=this.targetX+propTo.x;this.curProp.y=this.targetY+propTo.y;this.curProp.alpha=propTo.alpha;this.curProp.rotation=propTo.rotation;this.curProp.scaleX=propTo.scaleX;this.curProp.scaleY=propTo.scaleY}else{if(this.isLoop){Laya.timer.once(this.delayTime,this,()=>{this.propIndex=0;this.playNext()})}else{if(this.callBack)this.callBack()}return}this.target.x=this.targetX+propFrom.x;this.target.y=this.targetY+propFrom.y;this.target.alpha=propFrom.alpha;this.target.rotation=propFrom.rotation;this.target.scaleX=propFrom.scaleX;this.target.scaleY=propFrom.scaleY;Laya.Tween.to(this.target,this.curProp,propFrom.duration,Laya.Ease.linearIn,Laya.Handler.create(this,()=>{this.playNext()}))}stop(isHide=true){if(isHide){this.target.visible=false}this.isPlay=false;Laya.Tween.clearAll(this.target)}resetTarget(target){this.target=target;this.targetX=target.x;this.targetY=target.y}resetProp(arrProp,delayTime=-1){if(arrProp){this.arrProp=arrProp}if(delayTime>=0){this.delayTime=delayTime}}}common.TweenTarget=TweenTarget;class TweenProp{constructor(duration,x=-1,y=-1,alpha=1,rotation=0,scaleX=1,scaleY=1){this.duration=duration;this.x=x;this.y=y;this.alpha=alpha;this.rotation=rotation;this.scaleX=scaleX;this.scaleY=scaleY}}common.TweenProp=TweenProp;let TweenPropType;(function(TweenPropType){TweenPropType[TweenPropType["PING_PANG"]=0]="PING_PANG";TweenPropType[TweenPropType["PING_PANG_1"]=1]="PING_PANG_1";TweenPropType[TweenPropType["PING_PANG_2"]=2]="PING_PANG_2";TweenPropType[TweenPropType["GUIDE_SLID_1"]=3]="GUIDE_SLID_1";TweenPropType[TweenPropType["GUIDE_SLID_2"]=4]="GUIDE_SLID_2";TweenPropType[TweenPropType["GUIDE_CLICK"]=5]="GUIDE_CLICK";TweenPropType[TweenPropType["LIGHT_STAR"]=6]="LIGHT_STAR";TweenPropType[TweenPropType["SMALL_BIG"]=7]="SMALL_BIG"})(TweenPropType=common.TweenPropType||(common.TweenPropType={}))})(common=game.common||(game.common={}))})(game||(game={}));var game;(function(game){var common;(function(common){class TouchManager{constructor(){this._isCanTouch=true;this._isTouch=false;this._isPushEvent=false;this._isRelesePushEvent=false;this.RELESE_PUSH_TIME=.4;if(TouchManager._ins!=null)throw new Error("TouchManager is single!");TouchManager._ins=this;this.moveAnagle=[[0,50],[50,130],[130,229],[230,320],[320,360]];this.AngleToDirectionMap=[SwipeDirection.Right,SwipeDirection.Down,SwipeDirection.Left,SwipeDirection.Up,SwipeDirection.Right];this._startPoint=new Laya.Point;this._curPoint=new Laya.Point}static get ins(){if(!this._ins)new TouchManager;return this._ins}init(){Laya.stage.on(Laya.Event.MOUSE_DOWN,this,this.onMouseDown)}setTouch(v){this._isCanTouch=v}onMouseDown(t){if(!this._isCanTouch){return}Laya.stage.on(Laya.Event.MOUSE_MOVE,this,this.onMouseMove);Laya.stage.on(Laya.Event.MOUSE_UP,this,this.onMouseUp);Laya.stage.on(Laya.Event.MOUSE_OUT,this,this.onMouseUp);this._moveCount=0,this._isTouch=true,this._startPoint.setTo(Laya.stage.mouseX,Laya.stage.mouseY)}onMouseMove(t){if(this._isTouch&&(this._curPoint.x=Laya.stage.mouseX,this._curPoint.y=Laya.stage.mouseY,!this._isPushEvent)){let e=this._startPoint.distance(this._curPoint.x,this._curPoint.y),i=18;if(this._moveCount>0&&(i=20),e>=i){let n=new Laya.Vector2(this._curPoint.x-this._startPoint.x,this._curPoint.y-this._startPoint.y),r=this.GetSwipeDirection(n,1);common.EventManager.ins.event(common.NoticeEvent.TOUCH_DIRECTOR,{dir:r,startP:this._startPoint,endP:this._curPoint});this._isPushEvent=true,this.StartRelesePushEvent(),this._moveCount++}this._startPoint.setTo(this._curPoint.x,this._curPoint.y)}}onMouseUp(t){Laya.stage.off(Laya.Event.MOUSE_MOVE,this,this.onMouseMove);Laya.stage.off(Laya.Event.MOUSE_UP,this,this.onMouseUp);Laya.stage.off(Laya.Event.MOUSE_OUT,this,this.onMouseUp);this._isTouch=false,this.EndRelesePushEvent()}GetSwipeDirection(t,i){let n=MathUtil.changeAngle360(MathUtil.radianToAngle(Math.atan2(t.y,t.x)));for(let r=0;r<this.AngleToDirectionMap.length;++r){let startAngle=this.moveAnagle[r][0],endAngle=this.moveAnagle[r][1];if(n>=startAngle&&n<=endAngle)return this.AngleToDirectionMap[r]}return SwipeDirection.Non}UpdateRelesePushEvent(){}StartRelesePushEvent(){this._relesePushTime=0,this._isRelesePushEvent=true}EndRelesePushEvent(){this._isRelesePushEvent=false,this._isPushEvent=false,this._startPoint.setTo(this._curPoint.x,this._curPoint.y)}}common.TouchManager=TouchManager;let SwipeDirection;(function(SwipeDirection){SwipeDirection[SwipeDirection["Non"]=0]="Non";SwipeDirection[SwipeDirection["Left"]=1]="Left";SwipeDirection[SwipeDirection["Right"]=2]="Right";SwipeDirection[SwipeDirection["Up"]=3]="Up";SwipeDirection[SwipeDirection["Down"]=4]="Down"})(SwipeDirection=common.SwipeDirection||(common.SwipeDirection={}))})(common=game.common||(game.common={}))})(game||(game={}));var game;(function(game){var common;(function(common){class TipManager{constructor(){if(TipManager._ins!=null)throw new Error("TipManager is single!")}static get ins(){if(!this._ins)TipManager._ins=new TipManager;return this._ins}showImg(url,x=0,y=0,offH=-50){let imgEfct=new Laya.Image;imgEfct.skin=url;imgEfct.x=(game.Define.DeviceW-imgEfct.width)/2;imgEfct.x=x==0?(game.Define.DeviceW-imgEfct.width)/2:x;imgEfct.y=y==0?(game.Define.DeviceH-imgEfct.height)/2:y;LayerManager.ins.addChild(imgEfct,LayerName.top);Laya.Tween.to(imgEfct,{y:imgEfct.y+offH},500,null,Laya.Handler.create(this,()=>{imgEfct.removeSelf();imgEfct=null}))}showWord(msg,x=0,y=0,offH=-50,fontSize=40,fontColor="#000000"){let lbl=new Laya.Label;lbl.color=fontColor;lbl.fontSize=fontSize;lbl.text=msg;lbl.x=x==0?(game.Define.DeviceW-lbl.width)/2:x;lbl.y=y==0?(game.Define.DeviceH-lbl.height)/2:y;LayerManager.ins.addChild(lbl,LayerName.top);Laya.Tween.to(lbl,{y:lbl.y+offH},700,null,Laya.Handler.create(this,()=>{lbl.removeSelf();lbl=null}))}}common.TipManager=TipManager})(common=game.common||(game.common={}))})(game||(game={}));var game;(function(game){var common;(function(common){class SoundManager{constructor(){this.isOn=true;this.isShake=true;if(SoundManager._ins!=null)throw new Error("SoundManager is single!");if(Laya.Browser.onIOS){Laya.SoundManager.useAudioMusic=false}}static get ins(){if(!this._ins)SoundManager._ins=new SoundManager;return this._ins}preload(arr,callBack,progress){Laya.loader.load(arr,callBack,progress)}init(callBack){}setOn(v){this.isOn=v;Laya.SoundManager.muted=!v}playMusic(bt){if(!bt){console.log("播放背景声音参数不能为空！");return}if(this.isOn){if(Base64Manager.isUseBase64){Laya.SoundManager.playMusic(bt.base64Img)}else{Laya.SoundManager.playMusic(bt.id)}}}playSound(bt){if(!bt){console.log("播放声音参数不能为空！");return}if(this.isOn){if(Base64Manager.isUseBase64){Laya.SoundManager.playSound(bt.base64Img)}else{Laya.SoundManager.playSound(bt.id)}}}stopSound(soundName){Laya.SoundManager.stopSound(game.Define.CDN+soundName)}vibration(para){navigator.vibrate=navigator.vibrate||navigator["webkitVibrate"]||navigator["mozVibrate"]||navigator["msVibrate"];if(navigator.vibrate){console.log("支持设备震动！vibrate");navigator.vibrate(para)}else{console.log("不支持设备震动！")}}}common.SoundManager=SoundManager})(common=game.common||(game.common={}))})(game||(game={}));var game;(function(game){var common;(function(common){class ResManager{constructor(){if(ResManager._ins!=null)throw new Error("ResManager is single!")}static get ins(){if(!this._ins)ResManager._ins=new ResManager;return this._ins}preload(arrUrl,callBack,progress){Laya.loader.load(arrUrl,callBack,progress)}init(arrUrl,callBack,progress){Laya.loader.load(arrUrl,callBack,progress)}}common.ResManager=ResManager})(common=game.common||(game.common={}))})(game||(game={}));var game;(function(game){var common;(function(common){class OpenManager{constructor(){if(OpenManager._ins!=null)throw new Error("OpenManager is single!");OpenManager._ins=this;this.isDrawOpenView=false;this.wx=Laya.Browser.window.wx;this.init()}static get ins(){if(!this._ins)new OpenManager;return this._ins}init(){this.resizeStage()}postMsg(cmd,data){if(this.wx){var openDataContext=this.wx.getOpenDataContext();openDataContext.postMessage({cmd:cmd,data:data})}}resizeStage(){if(Laya.Browser.window.sharedCanvas){var scw=663;var sch=726;Laya.Browser.window.sharedCanvas.width=scw;Laya.Browser.window.sharedCanvas.height=sch;this.initOpenView()}}setLogin(){}setShareTicket(){}updateScore(){}showRankView(type){this.postMsg(common.NoticeEvent.ZY_RANK,null)}showOverView(){}showBeOverView(){}noticeUILoaded(data){}initOpenView(){if(Laya.Browser.window.sharedCanvas){this.openSp=new Laya.Sprite;this.openSp.on(Laya.Event.REMOVED,this,this.onRemoveOpenSp);this.openSp.pos(0,0)}}onRemoveOpenSp(){this.isDrawOpenView=false}changeOpenParent(parent,x,y){if(!Laya.Browser.window.sharedCanvas){return}this.isDrawOpenView=false;this.openSp.removeSelf();this.openSp.pos(x,y);if(parent){Laya.timer.once(1500,this,this.delayAddOpenSp,[parent])}}updateOpenView(){Laya.timer.once(2e3,this,this.drawOpenView)}delayAddOpenSp(parent){parent.addChild(this.openSp);this.isDrawOpenView=true;this.drawOpenView();this.updateOpenView()}drawOpenView(){if(this.isDrawOpenView){this.openSp.graphics.clear();if(this.openTex)this.openTex.destroy();this.openTex=new Laya.Texture(Laya.Browser.window.sharedCanvas);this.openSp.graphics.drawTexture(this.openTex,0,0,this.openTex.width,this.openTex.height)}}}common.OpenManager=OpenManager})(common=game.common||(game.common={}))})(game||(game={}));var game;(function(game){var base64;(function(base64_1){class Base64Manager{constructor(){this.loadIndex=0;if(Base64Manager._ins!=null)throw new Error("Base64Manager is single!");this.arrLoadAtlas=[]}static get ins(){if(!this._ins)Base64Manager._ins=new Base64Manager;return this._ins}init(){}loadAtlas(arrAtlas,callBack,progress){if(!arrAtlas||arrAtlas.length==0){if(callBack){callBack.run()}return}console.log("开始加载BASE64图集....共计："+arrAtlas.length);this.arrLoadAtlas=arrAtlas;this.callBack=callBack;this.progress=progress;this.loadIndex=0;this.parseAtlasNext()}parseAtlasNext(){if(this.progress&&this.progress.caller!=this){this.progress.runWith({data:this.loadIndex/this.arrLoadAtlas.length})}if(this.loadIndex>=this.arrLoadAtlas.length){if(this.callBack){this.callBack.run()}return}this.parseAtlas(this.arrLoadAtlas[this.loadIndex++])}parseAtlas(base64Type){if(base64Type.base64Img==null||base64Type.base64Img==""){this.cacheBase64Json(base64Type);return}if(base64Type.base64Json==null||base64Type.base64Json==""){this.cacheBase64Img(base64Type);return}let json=this.base64ToJson(base64Type.base64Json);let atlasName=json.meta.prefix;console.log("atlasName:",atlasName);Laya.loader.load(base64Type.base64Img,Laya.Handler.create(this,()=>{let imgBig=Laya.Loader.getRes(base64Type.base64Img);let frame=null;for(let key in json.frames){frame=json.frames[key].frame;if(imgBig.bitmap instanceof Laya.Texture||imgBig.bitmap instanceof Laya.Texture2D){let texture=Laya.Texture.create(imgBig.bitmap,frame.x,frame.y,frame.w,frame.h);Laya.Loader.cacheRes(atlasName+key,texture)}else{console.log("图集->"+key+" 不存在")}}this.parseAtlasNext()}))}cacheBase64Img(base64Type){Laya.loader.load(base64Type.base64Img,Laya.Handler.create(this,()=>{let imgBig=Laya.Loader.getRes(base64Type.base64Img);Laya.Loader.cacheRes(base64Type.id,imgBig);this.parseAtlasNext()}))}cacheBase64Json(base64Type){let json=this.base64ToJson(base64Type.base64Json);Laya.loader.cacheRes(base64Type.id,json);this.parseAtlasNext()}checkImg(img,base64Type){if(!img){console.error("参数为空");return}if(Base64Manager.isUseBase64){if(base64Type){img.skin=base64Type.base64Img}else{}}else{if(base64Type){img.skin=base64Type.id}else{}}}checkVideo(video,base64Type){if(!video){console.error("参数为空");return}if(Base64Manager.isUseBase64){if(base64Type){video.src=base64Type.base64Img}else{}}else{if(base64Type){video.src=base64Type.id}else{}}}base64ToJson(base64){let jsonStr=window.atob(base64);let json=JSON.parse(jsonStr);return json}base64ToUint8Array(base64String){const padding="=".repeat((4-base64String.length%4)%4);const base64=(base64String+padding).replace(/\-/g,"+").replace(/_/g,"/");const rawData=window.atob(base64);const outputArray=new Uint8Array(rawData.length);for(let i=0;i<rawData.length;++i){outputArray[i]=rawData.charCodeAt(i)}return outputArray}arrayBufferToBase64(buffer){var binary="";var bytes=new Uint8Array(buffer);var len=bytes.byteLength;for(var i=0;i<len;i++){binary+=String.fromCharCode(bytes[i])}return window.btoa(binary)}load(arrAtlas,callBack,progress){if(!arrAtlas||arrAtlas.length==0){if(callBack){callBack.run()}return}console.log("开始加载BASE64资源....共计："+arrAtlas.length);for(let base64type of arrAtlas){let fileType=base64type.id.substr(base64type.id.lastIndexOf(".")+1,base64type.id.length);if(base64type.id.indexOf("Assets/")>=0){base64type.id=base64type.id.substring(base64type.id.indexOf("Assets/"),base64type.id.length)}switch(fileType){case"ls":Laya.loader.cacheRes(base64type.id,Laya.Scene3D.load(this.base64ToJson(base64type.base64Json),null));break;case"lh":Laya.loader.cacheRes(base64type.id,Laya.Sprite3D.load(this.base64ToJson(base64type.base64Json),null));break;case"lmat":Laya.loader.cacheRes(base64type.id,Laya.BaseMaterial.load(this.base64ToJson(base64type.base64Json),null));break;case"lav":Laya.loader.cacheRes(base64type.id,Laya.Avatar._parse(this.base64ToJson(base64type.base64Json)));break;case"lm":Laya.loader.cacheRes(base64type.id,Laya.Mesh.load(this.base64ToJson(base64type.base64Json),null));break;case"lani":Laya.loader.cacheRes(base64type.id,Laya.AnimationClip.load(this.base64ToJson(base64type.base64Json),null));break;default:break}}if(callBack){callBack.run()}}checkMaterial(mat,bt,color=null){if(Base64Manager.isUseBase64){Laya.loader.load(bt.base64Img,Laya.Handler.create(this,e=>{if(mat instanceof Laya.BlinnPhongMaterial){mat.albedoTexture=e.bitmap;if(color){mat.albedoColor=new Laya.Vector4(1,1,1,1)}}}))}else{Laya.Texture2D.load(game.Define.CDN+"/atlas/"+bt.id,Laya.Handler.create(this,tex=>{if(mat instanceof Laya.BlinnPhongMaterial){mat.albedoTexture=tex;if(color){mat.albedoColor=new Laya.Vector4(1,1,1,1)}}}))}}}Base64Manager.isUseBase64=false;base64_1.Base64Manager=Base64Manager;class Base64Type{constructor(id,name,base64Json="",base64Img="",paramStr="",paramNum=0){this.id=id;this.name=name;this.base64Json=base64Json;this.base64Img=base64Img;this.paramStr=paramStr;this.paramNum=paramNum}}base64_1.Base64Type=Base64Type})(base64=game.base64||(game.base64={}))})(game||(game={}));var game;(function(game){var common;(function(common){class EventManager extends Laya.EventDispatcher{constructor(){super();if(EventManager._ins!=null)throw new Error("EventManager is single!")}static get ins(){if(!this._ins)EventManager._ins=new EventManager;return this._ins}init(){}event(type,data){super.on;return super.event(type,new NoticeEvent(type,data))}}common.EventManager=EventManager;class NoticeEvent{constructor(type,data){this.type=type;this.data=data}}NoticeEvent.PLATFORM_INIT_OVER="PLATFORM_INIT_OVER";NoticeEvent.PLATFORM_LOGIN_SUCCESS="PLATFORM_LOGIN_SUCCESS";NoticeEvent.PLATFORM_LOGIN_FAIL="PLATFORM_LOGIN_FAIL";NoticeEvent.GAME_RES_LOAD_FINISH="GAME_RES_LOAD_FINISH";NoticeEvent.HTTP_PROGRESS="HTTP_PROGRESS";NoticeEvent.TOUCH_DIRECTOR="TOUCH_DIRECTOR";NoticeEvent.BONE_TEMP_LOAD_FINISH="BONE_TEMP_LOAD_FINISH";NoticeEvent.SYS_FOCUS="SYS_FOCUS";NoticeEvent.SYS_BLUR="SYS_BLUR";NoticeEvent.SYS_SCREEN_VERTICAL="SYS_SCREEN_VERTICAL";NoticeEvent.SYS_SCREEN_HORIZONTAL="SYS_SCREEN_HORIZONTAL";NoticeEvent.SYS_SCREEN_VERTICAL_ONSIZE="SYS_SCREEN_VERTICAL_ONSIZE";NoticeEvent.SYS_SCREEN_HORIZONTAL_ONSIZE="SYS_SCREEN_HORIZONTAL_ONSIZE";NoticeEvent.AI_IMAGE_TO_WORD="AI_IMAGE_TO_WORD";NoticeEvent.ZY_RESIZE="ZY_RESIZE";NoticeEvent.ZY_LOGIN="ZY_LOGIN";NoticeEvent.ZY_RANK="ZY_RANK";NoticeEvent.ZY_SCORE="ZY_SCORE";common.NoticeEvent=NoticeEvent})(common=game.common||(game.common={}))})(game||(game={}));var game;(function(game){var effect;(function(effect){class BaseEffect extends Laya.Sprite{constructor(isScene){super();this.isPlaying=false;this.parentContainer=null;this.isScene=false;this.isInit=false;this.isScene=isScene;this.on(Laya.Event.ADDED,this,this.onAdd)}init(){}onAdd(event){if(!this.isInit){this.init();this.isInit=true}this.on(Laya.Event.REMOVED,this,this.onRmove);this.open()}onRmove(event){this.off(Laya.Event.REMOVED,this,this.onRmove);this.close()}isOpen(){return this!=null&&this.parent!=null}open(){}scaleH(){}scaleV(){}close(){this.isPlaying=false;Laya.Tween.clearAll(this);Laya.timer.clearAll(this)}setData(arrSprite,arrNumber=null,arrString=null){this.arrSprite=arrSprite;this.arrNumber=arrNumber;this.arrString=arrString}play(){if(this.isPlaying){return}if(!this.parent){if(this.parentContainer){this.parentContainer.addChild(this)}else{effect.EffectManager.ins.addEffect(this,this.isScene)}}this.isPlaying=true}stop(){this.removeSelf()}lineMove(line,from,to,time1,time2,delayTime=0){line.x=from;Laya.Tween.to(line,{x:to},time1,null,Laya.Handler.create(this,()=>{Laya.Tween.to(line,{x:from},time2,null,Laya.Handler.create(this,()=>{Laya.Tween.clearAll(line)}))}),delayTime)}}effect.BaseEffect=BaseEffect})(effect=game.effect||(game.effect={}))})(game||(game={}));var game;(function(game){var effect;(function(effect){class BossWarningEft extends effect.BaseEffect{constructor(isScene){super(isScene);this.imgLine1=null;this.imgLine2=null;this.imgLine3=null;this.imgLine4=null;this.imgLine5=null;this.imgBoss=null;this.lblWord=null;this.linePadding=30;this.imgLine1=new Laya.Image;this.addChild(this.imgLine1);this.imgLine2=new Laya.Image;this.addChild(this.imgLine2);this.imgLine3=new Laya.Image;this.addChild(this.imgLine3);this.imgLine4=new Laya.Image;this.addChild(this.imgLine4);this.imgLine5=new Laya.Image;this.addChild(this.imgLine5);this.imgBoss=new Laya.Image;this.imgBoss.anchorX=.5;this.addChild(this.imgBoss);this.lblWord=new Laya.Label;this.lblWord.anchorX=.5;this.lblWord.wordWrap=true;this.addChild(this.lblWord)}init(){}setData(arrSprite,arrNumber=null,arrString=null){super.setData(arrSprite,arrNumber,arrString);if(arrNumber){this.linePadding=arrNumber.length>0?arrNumber[0]:20}if(arrString){this.imgLine1.skin=arrString[0];this.imgLine2.skin=arrString[1];this.imgLine3.skin=arrString[0];this.imgLine4.skin=arrString[1];this.imgLine5.skin=arrString[0];this.imgLine1.y=-this.imgLine1.height-this.imgLine2.height-(this.imgLine3.height>>1);this.imgLine2.y=this.imgLine1.y+this.imgLine1.height+this.linePadding;this.imgLine3.y=this.imgLine2.y+this.imgLine2.height+this.linePadding;this.imgLine4.y=this.imgLine3.y+this.imgLine3.height+this.linePadding;this.imgLine5.y=this.imgLine4.y+this.imgLine4.height+this.linePadding;this.imgBoss.skin=arrString.length>2?arrString[2]:"";this.imgBoss.y=arrString.length>3?Number(arrString[3]):0;this.lblWord.text=arrString.length>4?arrString[4]:"";this.lblWord.y=arrString.length>5?Number(arrString[5]):0;this.lblWord.width=arrString.length>6?Number(arrString[6]):this.lblWord.displayWidth;this.lblWord.height=arrString.length>7?Number(arrString[7]):this.lblWord.displayHeight;this.lblWord.fontSize=arrString.length>8?Number(arrString[8]):30;this.lblWord.color=arrString.length>9?arrString[9]:"#ffffff";this.lblWord.stroke=arrString.length>10?Number(arrString[10]):0;this.lblWord.strokeColor=arrString.length>11?arrString[11]:""}}open(){}close(){super.close();Laya.Tween.clearAll(this.imgLine1);Laya.Tween.clearAll(this.imgLine2);Laya.Tween.clearAll(this.imgLine3);Laya.Tween.clearAll(this.imgLine4);Laya.Tween.clearAll(this.imgLine5);Laya.Tween.clearAll(this.imgBoss)}play(){super.play();let halfX=game.Define.DeviceW>>1;this.imgBoss.x=game.Define.DeviceH;Laya.Tween.to(this.imgBoss,{x:halfX},700,null,Laya.Handler.create(this,()=>{Laya.Tween.to(this.imgBoss,{x:-this.imgBoss.width},200,null,Laya.Handler.create(this,()=>{Laya.Tween.clearAll(this.imgBoss);this.isPlaying=false;this.stop()}),800)}));if(this.lblWord.text!=""){this.lblWord.x=game.Define.DeviceH;Laya.Tween.to(this.lblWord,{x:halfX},700,null,Laya.Handler.create(this,()=>{Laya.Tween.to(this.lblWord,{x:-this.lblWord.width},200,null,Laya.Handler.create(this,()=>{Laya.Tween.clearAll(this.lblWord)}),800)}))}let time1=600,time2=600;this.lineMove(this.imgLine1,game.Define.DeviceH,-this.imgLine1.width,time1,time2,100);this.lineMove(this.imgLine2,-this.imgLine2.width,game.Define.DeviceH,time1,time2,200);this.lineMove(this.imgLine3,game.Define.DeviceH,-this.imgLine3.width,time1,time2,300);this.lineMove(this.imgLine4,-this.imgLine4.width,game.Define.DeviceH,time1,time2,400);this.lineMove(this.imgLine5,game.Define.DeviceH,-this.imgLine5.width,time1,time2,500)}stop(){super.stop()}}effect.BossWarningEft=BossWarningEft})(effect=game.effect||(game.effect={}))})(game||(game={}));var game;(function(game){var effect;(function(effect){class ChangeImageEft extends effect.BaseEffect{constructor(isScene){super(isScene);this.arrImg=null;this.imgCount=0;this.changeTime=0;this.curIndex=0;this.curImg=null}init(){}setData(arrSprite,arrNumber=null,arrString=null){super.setData(arrSprite,arrNumber,arrString);if(arrString&&arrString.length>0){let img=null;this.arrImg=[];for(let skin of arrString){img=new Laya.Image;img.anchorX=img.anchorY=.5;img.skin=skin;this.addChild(img);this.arrImg.push(img)}this.imgCount=arrString.length;this.x=arrNumber.length>0?arrNumber[0]:game.Define.DeviceW>>1;this.y=arrNumber.length>1?arrNumber[1]:game.Define.DeviceH>>1;this.changeTime=arrNumber.length>2?arrNumber[2]:1e3;if(this.changeTime<=0)this.changeTime=1e3;if(arrSprite&&arrSprite.length>0&&arrSprite[0]){this.parentContainer=arrSprite[0]}}}close(){super.close();Laya.Tween.clearAll(this.curImg)}play(){super.play();if(!this.isPlaying){return}Laya.timer.loop(this.changeTime,this,()=>{this.curIndex++;if(this.curIndex>=this.imgCount){this.curIndex=0}let img;for(let i=0;i<this.imgCount;i++){img=this.arrImg[i];img.visible=i==this.curIndex;if(img.visible){this.curImg=img}}this.curImg.scaleX=this.curImg.scaleY=.2;Laya.Tween.to(this.curImg,{scaleX:1.2,scaleY:1.2},200,Laya.Ease.linearInOut,Laya.Handler.create(this,()=>{Laya.Tween.to(this.curImg,{scaleX:1,scaleY:1},100,Laya.Ease.linearInOut,Laya.Handler.create(this,()=>{}))}))})}stop(){super.stop()}}effect.ChangeImageEft=ChangeImageEft})(effect=game.effect||(game.effect={}))})(game||(game={}));var game;(function(game){var effect;(function(effect){class FountainEft extends effect.BaseEffect{constructor(isScene){super(isScene);this.oneSendTime=0;this.oneShowTime=0;this.minX=0;this.maxX=0;this.minY=0;this.maxY=0;this.needRotation=0;this.arrImg=[]}init(){}setData(arrSprite,arrNumber=null,arrString=null){super.setData(arrSprite,arrNumber,arrString);if(arrNumber){this.oneSendTime=arrNumber.length>0?arrNumber[0]:10;this.minX=arrNumber.length>1?arrNumber[1]:0;this.maxX=arrNumber.length>2?arrNumber[2]:1;this.minY=arrNumber.length>3?arrNumber[3]:0;this.maxY=arrNumber.length>4?arrNumber[4]:1;this.oneShowTime=arrNumber.length>5?arrNumber[5]:200;this.needRotation=arrNumber.length>6?arrNumber[6]:0}}open(){}close(){super.close();for(let img of this.arrImg){Laya.Tween.clearAll(img)}}play(){super.play();let halfX=game.Define.DeviceW>>1;Laya.timer.loop(this.oneSendTime,this,this.launch)}launch(){let randIndex=MathUtil.randomRange(0,this.arrString.length-1);let skin=this.arrString[randIndex];let img=this.getImg();if(!img){img=new Laya.Image;img.anchorX=img.anchorY=.5;img.skin=skin;this.arrImg.push(img)}img.x=0;img.y=0;this.addChild(img);let randY=MathUtil.randomRange(this.minY,this.maxY);let randX=MathUtil.randomRange(this.minX,this.maxX);randX=MathUtil.randomRange(0,1)==0?randX:-randX;img.x=MathUtil.randomRange(0,this.minX>>2);img.x=MathUtil.randomRange(0,1)==0?img.x:-img.x;Laya.Tween.to(img,{y:randY,rotation:this.needRotation*.4},this.oneShowTime*.3,Laya.Ease.cubicOut,Laya.Handler.create(this,()=>{Laya.Tween.to(img,{x:randX>>1,y:randY+50,rotation:this.needRotation*.7},this.oneShowTime*.4,Laya.Ease.cubicIn,Laya.Handler.create(this,()=>{Laya.Tween.to(img,{x:randX,y:0,rotation:this.needRotation},this.oneShowTime*.3,Laya.Ease.cubicIn,Laya.Handler.create(this,()=>{Laya.Tween.clearAll(img);img.removeSelf()}))}))}))}getImg(){let ret=null;for(let img of this.arrImg){if(img&&!img.parent){ret=img;break}}return ret}stop(){Laya.Tween.clearAll(this);Laya.timer.clearAll(this);super.stop();while(this.arrImg.length>0){let img=this.arrImg.shift();Laya.Tween.clearAll(img);img.removeSelf()}}}effect.FountainEft=FountainEft})(effect=game.effect||(game.effect={}))})(game||(game={}));var game;(function(game){var effect;(function(effect){class GuideClickEft extends effect.BaseEffect{constructor(isScene){super(isScene);this.imgCirle=null;this.imgHand=null;this.imgCirle=new Laya.Image;this.imgCirle.anchorX=this.imgCirle.anchorY=.5;this.imgCirle.alpha=.5;this.imgCirle.graphics.drawCircle(0,0,60,"#ffffff");this.addChild(this.imgCirle);this.imgHand=new Laya.Image;this.imgHand.anchorX=this.imgHand.anchorY=.5;this.addChild(this.imgHand)}init(){}setData(arrSprite,arrNumber=null,arrString=null){super.setData(arrSprite,arrNumber,arrString);this.imgHand.skin=arrString[0];this.imgHand.x=20;this.imgHand.y=20}close(){super.close();Laya.Tween.clearAll(this.imgCirle);Laya.Tween.clearAll(this.imgHand)}play(){super.play();let halfX=game.Define.DeviceW>>1;this.big(this.imgCirle,this.imgHand)}big(sp,hand){if(!this.isPlaying){return}Laya.Tween.to(hand,{scaleX:.5,scaleY:.5},350,null,Laya.Handler.create(this,()=>{Laya.Tween.clearTween(hand);Laya.Tween.to(hand,{scaleX:1,scaleY:1},350,null,Laya.Handler.create(this,()=>{Laya.Tween.clearTween(hand);this.big(sp,hand)}))}));Laya.timer.once(200,this,()=>{sp.scaleX=1;sp.scaleY=1;sp.alpha=.5;Laya.Tween.to(sp,{scaleX:2.5,scaleY:2.5,alpha:0},300,null,Laya.Handler.create(this,()=>{Laya.Tween.clearTween(sp)}))})}stop(){super.stop()}}effect.GuideClickEft=GuideClickEft})(effect=game.effect||(game.effect={}))})(game||(game={}));var game;(function(game){var king;(function(king){class BaseBone extends Laya.Sprite{constructor(type,cacheType=0,isAutoPlay=true,isLoop=false,layerName=null){super();this._objId=0;this.cacheType=0;this.kingType="boy";this.isAutoPlay=true;this.isLoop=false;this.layerName=null;this._randIndex=0;this.isLoad=false;this._objId=king.BoneManager.ins.boneIndex++;this.kingType=type;this.cacheType=cacheType;this.isAutoPlay=isAutoPlay;this.isLoop=isLoop;this.layerName=layerName;this.on(Laya.Event.ADDED,this,this.onAdd);EventManager.ins.on(NoticeEvent.BONE_TEMP_LOAD_FINISH,this,this.BONE_TEMP_LOAD_FINISH)}onAdd(e){this.on(Laya.Event.REMOVED,this,this.onRemoved);king.BoneManager.ins.dicBone.add(this.objId,this);this.init()}init(){if(!this._sk){this.resetSkin()}}BONE_TEMP_LOAD_FINISH(evt){if(evt.data==this.kingType&&!this._sk){if(!this.layerName){this.layerName=LayerName.scene_king}LayerManager.ins.addChild(this,this.layerName)}}resetSkin(){let temp=king.BoneManager.ins.getTemp(this.kingType);if(!temp){return}let sk=temp.buildArmature(this.cacheType);if(sk){this._sk=sk;this._sk.on(Laya.Event.STOPPED,this,this.onStop);this._sk.on(Laya.Event.COMPLETE,this,this.onComplete);this.addChild(this._sk);this.isLoad=true;EventManager.ins.off(NoticeEvent.BONE_TEMP_LOAD_FINISH,this,this.BONE_TEMP_LOAD_FINISH);if(this.isAutoPlay){this.play(this.isLoop)}}}get objId(){return this._objId}play(isLoop=false){this.visible=true;if(this._sk){if(this._randIndex>=this._sk.getAnimNum()){this._randIndex=0}this._sk.play(this._randIndex++,isLoop)}}stop(){if(this._sk){this._sk.stop()}}setActionType(at){this.curAticonType=at;if(this._sk){if(at<this._sk.getAnimNum()){this._sk.play(at,true)}}}setActionState(as){this.curAticonState=as}onStop(ev){this.visible=false}onComplete(ev){if(!this.isLoop){this.visible=false}if(this.callBack){this.callBack.run()}}onRemoved(e){this.off(Laya.Event.REMOVED,this,this.onRemoved);EventManager.ins.off(NoticeEvent.BONE_TEMP_LOAD_FINISH,this,this.BONE_TEMP_LOAD_FINISH)}}king.BaseBone=BaseBone})(king=game.king||(game.king={}))})(game||(game={}));var game;(function(game){var king;(function(king){class BaseKing extends Laya.Animation{constructor(){super();this.speed=1;this.isLoad=false}init(){this._dicActionTypeNext=new Dictionary;this.on(Laya.Event.REMOVED,this,this.onRemoved);this.on(Laya.Event.LABEL,this,this.onLabel);this.on(Laya.Event.STOPPED,this,this.onStop);this.on(Laya.Event.COMPLETE,this,this.onComplete)}setSkin(skinData,isAdd=true){if(skinData){this.skinData=skinData}else{console.log("this.skinData is null!")}if(this.skinData.arrAction&&this.skinData.arrAction.length>0){let action;for(let i=0;i<this.skinData.arrAction.length;i++){action=this.skinData.arrAction[i];Laya.Animation.createFrames(this.aniUrls(action.actionType.toString(),action.frameCount),this.skinData.kingType+"_"+action.actionType)}}else{for(let i=0;i<this.skinData.cutRow;i++){Laya.Animation.createFrames(this.aniUrls(i.toString(),this.skinData.cutCol),this.skinData.kingType+"_"+i)}}this.isLoad=true;this.setActionType(this.curAticonType);if(isAdd){king.KingManager.ins.addKing(this)}}setActionType(at,isLoop=true){this.curAticonType=at;if(this.isLoad){if(at!=undefined&&at>=0){this.play(0,isLoop,this.skinData.kingType+"_"+at);this.curAticonState=this.getActionState(at)}}}getActionState(at){let ret=null;switch(at){case ActionType.Left:case ActionType.Right:case ActionType.Up:case ActionType.Down:case ActionType.Left_up:case ActionType.Left_down:case ActionType.Right_up:case ActionType.Right_down:ret=ActionState.MOVE;break;case ActionType.JUMP:ret=ActionState.JUMP;break;case ActionType.ROLL:ret=ActionState.ROLL;break;case ActionType.DEAD:ret=ActionState.DEAD;break;default:break}return ret}setActionState(as){this.curAticonState=as}regAtcionTypeNext(at,atNext){this._dicActionTypeNext.add(at,atNext)}update(){}onLabel(ev){console.log(`complte `+ev)}onStop(ev){}onComplete(ev){if(this._dicActionTypeNext.hasKey(this.curAticonType)){this.setActionType(this._dicActionTypeNext.get(this.curAticonType))}}onRemoved(e){this.off(Laya.Event.REMOVED,this,this.onRemoved);this.off(Laya.Event.LABEL,this,this.onLabel);this.isLoad=false}aniUrls(actionName,length){var urls=[];for(var i=1;i<=length;i++){urls.push(this.skinData.atlasName+"/"+this.skinData.kingType+"_"+actionName+"_"+i+".png")}return urls}}king.BaseKing=BaseKing;class Action{constructor(actionType,frameCount){this.actionType=actionType;this.frameCount=frameCount}}king.Action=Action;class SkinData{constructor(atlasName,kingType,arrAction,cutRow=0,cutCol=0){this.atlasName="";this.kingType="";this.cutRow=1;this.cutCol=1;this.atlasName=atlasName;this.kingType=kingType;this.cutRow=cutRow;this.cutCol=cutCol;this.arrAction=arrAction}}king.SkinData=SkinData;let ActionType;(function(ActionType){ActionType[ActionType["Wait"]=0]="Wait";ActionType[ActionType["Left"]=1]="Left";ActionType[ActionType["Right"]=2]="Right";ActionType[ActionType["Up"]=3]="Up";ActionType[ActionType["Down"]=4]="Down";ActionType[ActionType["Left_up"]=5]="Left_up";ActionType[ActionType["Left_down"]=6]="Left_down";ActionType[ActionType["Right_up"]=7]="Right_up";ActionType[ActionType["Right_down"]=8]="Right_down";ActionType[ActionType["JUMP"]=9]="JUMP";ActionType[ActionType["ROLL"]=10]="ROLL";ActionType[ActionType["ATTACK"]=11]="ATTACK";ActionType[ActionType["ATTACKED"]=12]="ATTACKED";ActionType[ActionType["DEAD"]=13]="DEAD"})(ActionType=king.ActionType||(king.ActionType={}));let ActionState;(function(ActionState){ActionState[ActionState["NONE"]=0]="NONE";ActionState[ActionState["MOVE"]=1]="MOVE";ActionState[ActionState["JUMP"]=2]="JUMP";ActionState[ActionState["ROLL"]=3]="ROLL";ActionState[ActionState["ATTACK"]=4]="ATTACK";ActionState[ActionState["DEAD"]=5]="DEAD"})(ActionState=king.ActionState||(king.ActionState={}))})(king=game.king||(game.king={}))})(game||(game={}));var game;(function(game){var platform;(function(platform_1){class PlatformManager{constructor(){if(PlatformManager._ins!=null)throw new Error("PlatformManager is single!");PlatformManager._ins=this}static get ins(){if(!this._ins)new PlatformManager;return this._ins}init(data){var platform;let isLocal=false;PlatformManager.mraid=Laya.Browser.window.mraid;if(Laya.Browser.window.wx){platform=PlatformManager.wxPlatform=new platform_1.WxPlatform}else if(Laya.Browser.window.facebook){PlatformManager.mraid=Laya.Browser.window.FbPlayableAd;platform=PlatformManager.fbPlatform=new platform_1.FaceBookPlatform}else if(Laya.Browser.window.applovin){platform=PlatformManager.alPlatform=new platform_1.ApplovinPlatform}else if(Laya.Browser.window.ironsource){PlatformManager.mraid=Laya.Browser.window.dapi;platform=PlatformManager.isPlatform=new platform_1.IronSourcePlatform}else if(Laya.Browser.window.unity){platform=PlatformManager.utPlatform=new platform_1.UnityPlatform}else if(Laya.Browser.window.google){platform=PlatformManager.ggPlatform=new platform_1.GooglePlatform}else if(Laya.Browser.window.mtg){platform=PlatformManager.mtgPlatform=new platform_1.MTGPlatform}else if(Laya.Browser.window.vungle){platform=PlatformManager.vgPlatform=new platform_1.VunglePlatform}else if(Laya.Browser.window.adcolony){platform=PlatformManager.acPlatform=new platform_1.AdColonyPlatform}else{console.log("默认平台，请注意检查平台是否设置 window.applovin 或 window.ironsource");platform=new platform_1.LocalPlatform;isLocal=true}if(!isLocal){Base64Manager.isUseBase64=true}console.log("BASE64Manager.isUseBase64",Base64Manager.isUseBase64);game.Global.platform=platform;game.Global.platform.init(data)}get HttpConfig(){return{}}static get wx(){return Laya.Browser.window.wx}static get window(){return Laya.Browser.window}static get fileSysMgr(){if(!this.wx)return null;return this.wx.getFileSystemManager()}actionCallBack(action,para=null){if(game.Global.platformId==PlatformID.mtg){switch(action){case PlatformAction.DownLoad:if(Laya.Browser.window.install){console.log("调用 window.install");Laya.Browser.window.install()}else{TipManager.ins.showWord("MTG does not support window.install!")}break;case PlatformAction.GameStart:console.log("MTG 主动调用gameStart！");break;case PlatformAction.GameReady:if(Laya.Browser.window.gameReady){console.log("调用 window.gameReady");Laya.Browser.window.gameReady()}else{TipManager.ins.showWord("MTG does not support window.gameReady!")}break;case PlatformAction.GameEnd:if(Laya.Browser.window.gameEnd){console.log("调用 window.gameEnd");Laya.Browser.window.gameEnd()}else{TipManager.ins.showWord("MTG does not support window.gameEnd!")}break;case PlatformAction.GameClose:console.log("MTG 主动调用gameClose！");break}}else if(game.Global.platformId==PlatformID.Is){let NUC=Laya.Browser.window.NUC;if(!NUC){console.log("当前为IronSource渠道，NUC不存在，无法上报用户行为追踪！");return}switch(action){case PlatformAction.DownLoad:if(NUC.trigger&&NUC.trigger.convert){console.log("调用 NUC.trigger.convert");NUC.trigger.convert()}else{TipManager.ins.showWord("IronSourc does not support NUC.trigger.convert!")}break;case PlatformAction.GameStart:if(NUC.trigger&&NUC.trigger.startLevel){console.log("调用 NUC.trigger.startLevel");NUC.trigger.startLevel()}else{TipManager.ins.showWord("IronSource does not support NUC.trigger.startLevel!")}break;case PlatformAction.GameReady:if(Laya.Browser.window.gameReady){console.log("调用 window.gameReady");Laya.Browser.window.gameReady()}else{TipManager.ins.showWord("IronSource does not support window.gameReady!")}break;case PlatformAction.GameEnd:if(NUC.trigger&&NUC.trigger.endGame){console.log("调用 NUC.trigger.endGame");NUC.trigger.endGame("win")}else{TipManager.ins.showWord("IronSource does not support NUC.trigger.endGame!")}break;case PlatformAction.GameCustom:if(NUC.event&&NUC.event.send){console.log("调用 NUC.event.send");NUC.event.send("mouseclick",para)}else{TipManager.ins.showWord("IronSource does not support NUC.event.send!")}break}}else if(game.Global.platformId==PlatformID.Vg){switch(action){case PlatformAction.DownLoad:break;case PlatformAction.GameStart:break;case PlatformAction.GameReady:break;case PlatformAction.GameEnd:if(parent){console.log("调用 parent.postMessage('complete','*')");parent.postMessage("complete","*")}else{TipManager.ins.showWord("Vungle does not support parent.postMessage!")}break;case PlatformAction.GameCustom:break}}else{}}}platform_1.PlatformManager=PlatformManager;let PlatformID;(function(PlatformID){PlatformID[PlatformID["None"]=0]="None";PlatformID[PlatformID["Wx"]=1]="Wx";PlatformID[PlatformID["Fb"]=2]="Fb";PlatformID[PlatformID["Al"]=3]="Al";PlatformID[PlatformID["Is"]=4]="Is";PlatformID[PlatformID["Ut"]=5]="Ut";PlatformID[PlatformID["Gg"]=6]="Gg";PlatformID[PlatformID["Vg"]=7]="Vg";PlatformID[PlatformID["Ac"]=8]="Ac";PlatformID[PlatformID["mtg"]=9]="mtg"})(PlatformID=platform_1.PlatformID||(platform_1.PlatformID={}));let LangType;(function(LangType){LangType[LangType["Zh"]=0]="Zh";LangType[LangType["En"]=1]="En"})(LangType=platform_1.LangType||(platform_1.LangType={}));let PlatformAction;(function(PlatformAction){PlatformAction[PlatformAction["None"]=0]="None";PlatformAction[PlatformAction["DownLoad"]=1]="DownLoad";PlatformAction[PlatformAction["GameEnd"]=2]="GameEnd";PlatformAction[PlatformAction["GameReady"]=3]="GameReady";PlatformAction[PlatformAction["GameStart"]=4]="GameStart";PlatformAction[PlatformAction["GameClose"]=5]="GameClose";PlatformAction[PlatformAction["GameCustom"]=6]="GameCustom"})(PlatformAction=platform_1.PlatformAction||(platform_1.PlatformAction={}))})(platform=game.platform||(game.platform={}))})(game||(game={}));var game;(function(game){var platform;(function(platform){var EventManager=game.common.EventManager;var NoticeEvent=game.common.NoticeEvent;class LocalPlatform{constructor(){this.window=platform.PlatformManager.window;this.fileSysMgr=platform.PlatformManager.fileSysMgr;game.Global.platformId=platform.PlatformID.None;game.Define.langId=platform.LangType.En;game.Define.serverHttp="http://192.168.2.104:3000/";game.Define.isLocal=true;EventManager.ins.init()}init(data){if(data){this.getRandomShareFunc=data.getRandomShare;this.isCanPlayVideoFunc=data.sCanPlayVideo;this.getAdDataFunc=data.getAdData;this.getAdVideoDataFunc=data.getAdVideoData;console.log("平台初始化："+data.getRandomShare)}if(game.Global.platformId==platform.PlatformID.None){EventManager.ins.event(NoticeEvent.PLATFORM_INIT_OVER)}}initSkinGame(){}login(){this.loginSuccess()}loginSuccess(){EventManager.ins.event(NoticeEvent.PLATFORM_LOGIN_SUCCESS)}getUserInfo(){return this.userInfo}initItem(){console.log("需要平台实现此功能")}saveItem(ID,count,type){console.log("需要平台实现此功能")}scoreUp(rank,score){console.log("需要平台实现此功能")}share(func,queryKey){console.log("需要平台实现此功能")}createBannerAd(posKey){console.log("需要平台实现此功能")}showBannerAd(isShow){console.log("需要平台实现此功能")}destroyBannerAd(){console.log("需要平台实现此功能")}createVideoAd(posKey,success){console.log("创建广告："+posKey)}addMoreGameBtn(parent){console.log("需要平台实现此功能 微信独有")}createBrandSprite(parent,x,y){console.log("需要平台实现此功能 微信独有")}postMsg(postName,obj){console.log("需要平台实现此功能 微信独有")}shake(isShort,delay){console.log("需要平台实现此功能")}saveImageToPhotosAlbum(url){console.log("保存图片接口没有实现")}setUserCloudStorage(key,value){console.log("云端保存数据接口没有实现")}getLocalImage(type){console.log("需要平台实现此功能")}onShowCallBack(res){console.log("小游戏获得焦点，进入前台运行")}onHideCallBack(){console.log("小游戏失去焦点，进入后台运行");Laya.SoundManager.stopMusic()}}platform.LocalPlatform=LocalPlatform})(platform=game.platform||(game.platform={}))})(game||(game={}));var game;(function(game){var platform;(function(platform){class AdColonyPlatform extends platform.LocalPlatform{constructor(){super();game.Global.platformId=platform.PlatformID.Ac;game.Define.langId=platform.LangType.En;game.Define.isLocal=true;game.Define.serverHttp="http://192.168.2.104:3000/"}init(){super.init({});this.initGameSkin();EventManager.ins.event(NoticeEvent.PLATFORM_INIT_OVER)}initGameSkin(){}login(){this.loginSuccess()}loginSuccess(){console.log("AdColony 登录成功！");EventManager.ins.event(NoticeEvent.PLATFORM_LOGIN_SUCCESS)}getSwitchState(){return true}initItem(){}saveItem(ID,count,type){}scoreUp(rank,score){super.scoreUp(rank,score);if(rank==1){Laya.timer.once(200,this,this.firstUp)}}firstUp(){}}platform.AdColonyPlatform=AdColonyPlatform})(platform=game.platform||(game.platform={}))})(game||(game={}));var game;(function(game){var platform;(function(platform){class ApplovinPlatform extends platform.LocalPlatform{constructor(){super();game.Global.platformId=platform.PlatformID.Al;game.Define.langId=platform.LangType.En;game.Define.isLocal=true;game.Define.serverHttp="http://192.168.2.104:3000/"}init(){super.init({});this.initGameSkin();EventManager.ins.event(NoticeEvent.PLATFORM_INIT_OVER)}initGameSkin(){}login(){this.loginSuccess()}loginSuccess(){console.log("Applovin 登录成功！");EventManager.ins.event(NoticeEvent.PLATFORM_LOGIN_SUCCESS)}getSwitchState(){return true}initItem(){}saveItem(ID,count,type){}scoreUp(rank,score){super.scoreUp(rank,score);if(rank==1){Laya.timer.once(200,this,this.firstUp)}}firstUp(){}}platform.ApplovinPlatform=ApplovinPlatform})(platform=game.platform||(game.platform={}))})(game||(game={}));var game;(function(game){var platform;(function(platform){class FaceBookPlatform extends platform.LocalPlatform{constructor(){super();game.Global.platformId=platform.PlatformID.Fb;game.Define.langId=platform.LangType.En;game.Define.isLocal=true;game.Define.serverHttp="http://192.168.2.104:3000/"}init(){super.init({});this.initGameSkin();EventManager.ins.event(NoticeEvent.PLATFORM_INIT_OVER)}initGameSkin(){}login(){this.loginSuccess()}loginSuccess(){console.log("FaceBook 登录成功！");EventManager.ins.event(NoticeEvent.PLATFORM_LOGIN_SUCCESS)}getSwitchState(){return true}initItem(){}saveItem(ID,count,type){}scoreUp(rank,score){super.scoreUp(rank,score);if(rank==1){Laya.timer.once(200,this,this.firstUp)}}firstUp(){}}platform.FaceBookPlatform=FaceBookPlatform})(platform=game.platform||(game.platform={}))})(game||(game={}));var game;(function(game){var platform;(function(platform){class GooglePlatform extends platform.LocalPlatform{constructor(){super();game.Global.platformId=platform.PlatformID.Gg;game.Define.langId=platform.LangType.En;game.Define.isLocal=true;game.Define.serverHttp="http://192.168.2.104:3000/"}init(){super.init({});this.initGameSkin();EventManager.ins.event(NoticeEvent.PLATFORM_INIT_OVER)}initGameSkin(){}login(){this.loginSuccess()}loginSuccess(){console.log("Google 登录成功！");EventManager.ins.event(NoticeEvent.PLATFORM_LOGIN_SUCCESS)}getSwitchState(){return true}initItem(){}saveItem(ID,count,type){}scoreUp(rank,score){super.scoreUp(rank,score);if(rank==1){Laya.timer.once(200,this,this.firstUp)}}firstUp(){}}platform.GooglePlatform=GooglePlatform})(platform=game.platform||(game.platform={}))})(game||(game={}));var game;(function(game){var platform;(function(platform){class IronSourcePlatform extends platform.LocalPlatform{constructor(){super();game.Global.platformId=platform.PlatformID.Is;game.Define.langId=platform.LangType.En;game.Define.isLocal=true;game.Define.serverHttp="http://192.168.2.104:3000/"}init(){super.init({});this.initGameSkin();EventManager.ins.event(NoticeEvent.PLATFORM_INIT_OVER)}initGameSkin(){}login(){this.loginSuccess()}loginSuccess(){console.log("IronSource 登录成功！");EventManager.ins.event(NoticeEvent.PLATFORM_LOGIN_SUCCESS)}getSwitchState(){return true}initItem(){}saveItem(ID,count,type){}scoreUp(rank,score){super.scoreUp(rank,score);if(rank==1){Laya.timer.once(200,this,this.firstUp)}}firstUp(){}}platform.IronSourcePlatform=IronSourcePlatform})(platform=game.platform||(game.platform={}))})(game||(game={}));var game;(function(game){var platform;(function(platform){class MTGPlatform extends platform.LocalPlatform{constructor(){super();game.Global.platformId=platform.PlatformID.mtg;game.Define.langId=platform.LangType.Zh;game.Define.isLocal=true;game.Define.serverHttp="http://192.168.2.104:3000/"}init(){super.init({});this.initGameSkin();EventManager.ins.event(NoticeEvent.PLATFORM_INIT_OVER);Laya.Browser.window.gameStart=(()=>{platform.PlatformManager.ins.actionCallBack(platform.PlatformAction.GameStart)})}initGameSkin(){}login(){platform.PlatformManager.ins.actionCallBack(platform.PlatformAction.GameReady);this.loginSuccess()}loginSuccess(){console.log("MTG 登录成功！");EventManager.ins.event(NoticeEvent.PLATFORM_LOGIN_SUCCESS)}getSwitchState(){return true}initItem(){}saveItem(ID,count,type){}scoreUp(rank,score){super.scoreUp(rank,score);if(rank==1){Laya.timer.once(200,this,this.firstUp)}}firstUp(){}}platform.MTGPlatform=MTGPlatform})(platform=game.platform||(game.platform={}))})(game||(game={}));var game;(function(game){var platform;(function(platform){class UnityPlatform extends platform.LocalPlatform{constructor(){super();game.Global.platformId=platform.PlatformID.Ut;game.Define.langId=platform.LangType.En;game.Define.isLocal=true;game.Define.serverHttp="http://192.168.2.104:3000/"}init(){super.init({});this.initGameSkin();EventManager.ins.event(NoticeEvent.PLATFORM_INIT_OVER)}initGameSkin(){}login(){this.loginSuccess()}loginSuccess(){console.log("Unity 登录成功！");EventManager.ins.event(NoticeEvent.PLATFORM_LOGIN_SUCCESS)}getSwitchState(){return true}initItem(){}saveItem(ID,count,type){}scoreUp(rank,score){super.scoreUp(rank,score);if(rank==1){Laya.timer.once(200,this,this.firstUp)}}firstUp(){}}platform.UnityPlatform=UnityPlatform})(platform=game.platform||(game.platform={}))})(game||(game={}));var game;(function(game){var platform;(function(platform){class VunglePlatform extends platform.LocalPlatform{constructor(){super();game.Global.platformId=platform.PlatformID.Vg;game.Define.langId=platform.LangType.En;game.Define.isLocal=true;game.Define.serverHttp="http://192.168.2.104:3000/"}init(){super.init({});this.initGameSkin();EventManager.ins.event(NoticeEvent.PLATFORM_INIT_OVER)}initGameSkin(){}login(){this.loginSuccess()}loginSuccess(){console.log("Vungle 登录成功！");EventManager.ins.event(NoticeEvent.PLATFORM_LOGIN_SUCCESS)}getSwitchState(){return true}initItem(){}saveItem(ID,count,type){}scoreUp(rank,score){super.scoreUp(rank,score);if(rank==1){Laya.timer.once(200,this,this.firstUp)}}firstUp(){}}platform.VunglePlatform=VunglePlatform})(platform=game.platform||(game.platform={}))})(game||(game={}));var game;(function(game){var platform;(function(platform){var EventManager=game.common.EventManager;var NoticeEvent=game.common.NoticeEvent;var OpenManager=game.common.OpenManager;class WxPlatform extends platform.LocalPlatform{constructor(){super();game.Global.platformId=platform.PlatformID.Wx;game.Define.langId=platform.LangType.Zh;game.Define.isLocal=false;game.Define.serverHttp="http://192.168.2.104:3000/";this.wx=Laya.Browser.window.wx}init(data){super.init(data);this.initSysInfo();let th=this;this.wx.onShow(res=>{this.onShowCallBack(res)});this.wx.onHide(()=>{this.onHideCallBack()});this.wx.showShareMenu({withShareTicket:true,success:e=>{console.log("wx.showShareMenu成功")},fail:e=>{console.log("wx.showShareMenu失敗")}});this.wx.getSetting({success(res){var authSetting=res.authSetting;if(authSetting["scope.userInfo"]===true){console.log("用户已授权");th.getWxUserInfo()}else if(authSetting["scope.userInfo"]===false){console.log("用户已拒绝授权");th.wx.showModal({title:"提示",content:"继续游戏需要获得你的授权",success(res){if(res.confirm){th.wx.openSetting({success(res){th.getWxUserInfo()}})}else if(res.cancel){console.log("用户点击取消")}else{}}})}else{console.log("未询问过用户授权");th.wx.authorize({scope:"scope.userInfo",success(){th.getWxUserInfo()},fail(){th.getWxUserInfo()}})}}});this.initSkinGame()}getWxUserInfo(){let th=this;this.wx.onShareAppMessage(()=>{var data=this.getRandomShareFunc?this.getRandomShareFunc.run():{title:"分享测试",imageUrl:""};var query="openid="+game.Global.openId+"&uid="+game.Global.UID;console.log("wx.onShareAppMessage openId="+game.Global.openId+" uid="+game.Global.UID);return{title:data.title,imageUrl:data.imageUrl,query:query,success:res=>{game.Global.shareTicket=res.shareTickets;console.log("wx.onShareAppMessage success!shareTicket="+game.Global.openId)}}});this.wx.getUserInfo({success(res){th.userInfo=res.userInfo;EventManager.ins.event(NoticeEvent.PLATFORM_INIT_OVER)},fail(){EventManager.ins.event(NoticeEvent.PLATFORM_INIT_OVER)}})}initSkinGame(){console.log("当前 GameID:"+game.Define.gameId+" AppID:"+game.Define.appId)}login(){let ths=this;this.wx.login({timeout:1e4,success:function(e){console.log("微信登录成功！ "+e.errMsg+"！code="+e.code);game.Global.code=e.code;game.Global.platform.loginSuccess()},fail:function(e){console.log(e.errMsg+"！")}})}loginSuccess(){var fromid;var query=game.Global.query;if(query){if(query.hasOwnProperty("openid")){if(query.hasOwnProperty("gold")){fromid=query.openid}}if(query.hasOwnProperty("signGold")){}}OpenManager.ins.setLogin();EventManager.ins.event(NoticeEvent.PLATFORM_LOGIN_SUCCESS)}initItem(){}saveItem(ID,count,type){}share(func,queryKey){this.shareAppSuccess=func;var data=this.getRandomShareFunc?this.getRandomShareFunc.run():{title:"分享一个好玩的游戏",imageUrl:"res/atlas/not/share.jpg"};var query="openid="+game.Global.openId+"&uid="+game.Global.UID;if(queryKey!=null){query+="&"+queryKey}this.wx.updateShareMenu({success:e=>{this.wx.shareAppMessage({title:data.title,imageUrl:data.imageUrl,query:query,success(res){}});console.log("分享标题："+data.title+" 分享内容图片："+data.imageUrl+" query="+query)}})}createBannerAd(adName){if(this.bannerAd){this.bannerAd.destroy()}let ad=this.getAdDataFunc?this.getAdDataFunc.runWith(adName):null;if(!ad){console.log("未找到图片广告配置："+ad.adName);return}this.bannerAd=this.wx.createBannerAd({adUnitId:ad.adUnitId,style:{left:ad.left,top:ad.top,width:ad.width,height:ad.height}});this.bannerAd.onError(err=>{console.log(err)});this.bannerAd.onLoad(()=>{console.log("banner 广告加载成功")});this.bannerAd.onResize(res=>{let width=res.width,height=res.height;this.bannerAd.style.top=window.innerHeight-height});this.showBannerAd(true)}showBannerAd(isShow){if(!this.bannerAd){return}if(isShow){this.bannerAd.show()}else{this.bannerAd.hide()}}destroyBannerAd(){if(this.bannerAd){this.bannerAd.offError();this.bannerAd.offLoad();this.bannerAd.offResize();this.bannerAd.destroy();this.bannerAd=null}}createVideoAd(adName,callBack){let ad=this.getAdVideoDataFunc?this.getAdVideoDataFunc.runWith(adName):null;if(!ad){console.log("未找到视频广告配置："+adName);return}if(ad.playCount>=ad.maxPlayCount){console.log("视频播放超过上限："+adName);return}if(this.isCanPlayVideoFunc&&!this.isCanPlayVideoFunc.runWith(adName)){return}this.videoAd=this.wx.createRewardedVideoAd({adUnitId:ad.adUnitId});this.videoAd.onClose(res=>{if(res&&res.isEnded||res===undefined){callBack&&callBack.run()}else{this.wx.showModal({title:"提示",content:"视频未播放完"})}});this.wx.showLoading({title:"视频加载中",mask:true});this.videoAd.load().then(()=>{this.wx.hideLoading();return this.videoAd.show()}).catch(err=>{console.log(err);this.wx.hideLoading();this.wx.showModal({title:"提示",content:"视频加载失败, 请稍后再试"})})}shake(isShort,delay){console.log("调用微信手机震动");if(isShort){this.wx.vibrateShort(delay)}else{this.wx.vibrateLong(delay)}}saveImageToPhotosAlbum(filePath){var file;var md5=file.md5;var jdPath="";this.wx.saveImageToPhotosAlbum({filePath:jdPath,success:function(res){console.log("保存图片成功")},fail:function(e){console.log("保存图片失败！"+JSON.stringify(e))}})}getLocalImage(type){var that=this;this.wx.chooseImage({count:1,sizeType:["original","compressed"],sourceType:["album","camera"],success:res=>{var filePath=res.tempFilePaths[0];var session_key=this.wx.getStorageSync("session_key");var base64=this.wx.getFileSystemManager().readFileSync(filePath,"base64");let data={};data["image"]=base64;let url="";let access_token="24.3fa0c0561fbfacf7b51cdca51328247e.2592000.1554966363.282335-15738709";if(type==0){url="https://aip.baidubce.com/rest/2.0/ocr/v1/idcard?access_token="+access_token;data["id_card_side"]="front"}else if(type==1){url="https://aip.baidubce.com/rest/2.0/ocr/v1/general_basic?access_token="+access_token}this.wx.request({url:url,data:data,method:"post",header:{"content-type":"application/x-www-form-urlencoded"},success:function(res){console.log(res.data);EventManager.ins.event(NoticeEvent.AI_IMAGE_TO_WORD,res.data)}})},fail:function(error){console.error("调用本地相册文件时出错");console.warn(error)},complete:function(){}})}setUserCloudStorage(key,value){console.log("开始保存数据到云端！");var KVDataList=[{key:key,value:String(value)}];this.wx.setUserCloudStorage({KVDataList:KVDataList,success:function(){console.log("保存数据到云端！")},fail:function(){}})}postMsg(cmd,data){var openDataContext=this.wx.getOpenDataContext();openDataContext.postMessage({cmd:cmd,data:data})}onShowCallBack(res){super.onShowCallBack(res);game.Global.query=res.query;game.Global.shareTicket=res.shareTicket;console.log("wx onShow! query="+JSON.stringify(game.Global.query)+",shareTicket="+game.Global.shareTicket);if(game.Global.shareTicket!=null&&game.Global.shareTicket!=""){OpenManager.ins.setShareTicket();console.log("微信转发已经提交服务器")}if(this.shareAppSuccess!=null){this.shareAppSuccess();this.shareAppSuccess=null}}onHideCallBack(){super.onHideCallBack()}initSysInfo(){var res=this.wx.getSystemInfoSync();game.Global.BRAND=res.brand;game.Global.MODEL=res.model;game.Global.SYSTEM=res.system;console.log("brand:"+game.Global.BRAND+",model:"+game.Global.MODEL+",system:"+game.Global.SYSTEM);if(this.wx.getUpdateManager instanceof Function){var t=this.wx.getUpdateManager();t.onCheckForUpdate(function(t){console.log("小游戏是否有新版本："+t.hasUpdate)}),t.onUpdateReady(function(){t.applyUpdate()}),t.onUpdateFailed(function(){})}}showModal(title,content,isCancel){this.wx.showModal({title:title,content:content,showCancel:isCancel})}removeUserCloudStorage(key){this.wx.removeUserCloudStorage({KVDataList:[key],success:function(){console.log("托管数据"+key+"删除成功")},fail:function(){console.log("托管数据"+key+"删除失败")}})}}platform.WxPlatform=WxPlatform;let WeChatCall;(function(WeChatCall){WeChatCall[WeChatCall["FAIL"]=0]="FAIL";WeChatCall[WeChatCall["SUCCESS"]=1]="SUCCESS";WeChatCall[WeChatCall["NO_MINI"]=2]="NO_MINI"})(WeChatCall||(WeChatCall={}))})(platform=game.platform||(game.platform={}))})(game||(game={}));var game;(function(game){var ui;(function(ui){class BaseFrame extends Laya.Animation{constructor(frameName,frameCount,isLoop=true,isAutoPlay=true,layer=null,atlasName="frame",callBack=null){super();this.frameName="";this.frameCount=1;this.isLoop=false;this.isAutoPlay=false;this.isAutoAdd=false;this.isLoad=false;this.frameName=frameName;this.frameCount=frameCount;this.isLoop=isLoop;this.isAutoPlay=isAutoPlay;this.layer=layer;this.atlasName=atlasName;this.callBack=callBack;this.on(Laya.Event.ADDED,this,this.onAdd)}onAdd(){this.off(Laya.Event.ADDED,this,this.onAdd);this.on(Laya.Event.REMOVED,this,this.onRemoved);this.on(Laya.Event.LABEL,this,this.onLabel);this.on(Laya.Event.STOPPED,this,this.onStop);this.on(Laya.Event.COMPLETE,this,this.onComplete)}init(){}setAtlas(){this.loadFinish()}loadFinish(){this.isLoad=true;let arr=[];for(let i=1;i<=this.frameCount;i++){arr.push(this.atlasName+"/"+this.frameName+"_"+i+".png")}Laya.Animation.createFrames(arr,this.frameName);if(this.isAutoPlay){this.playFrame()}if(this.layer){ui.UIManager.ins.addFrameAnimation(this,this.layer)}}playFrame(){if(this.isLoad){this.visible=true;this.play(0,this.isLoop,this.frameName)}}stopFrame(){this.visible=false;this.stop()}onLabel(ev){}onStop(ev){this.visible=false}onComplete(ev){if(!this.isLoop){this.visible=false}if(this.callBack){this.callBack.run()}}onRemoved(e){this.on(Laya.Event.ADDED,this,this.onAdd);this.off(Laya.Event.REMOVED,this,this.onRemoved);this.off(Laya.Event.LABEL,this,this.onLabel);this.off(Laya.Event.STOPPED,this,this.onStop);this.off(Laya.Event.COMPLETE,this,this.onStop);Laya.timer.clearAll(this);this.isLoad=false}}ui.BaseFrame=BaseFrame})(ui=game.ui||(game.ui={}))})(game||(game={}));var game;(function(game){var ui;(function(ui){class BaseWindow extends ui.BaseUI{constructor(viewCls){super();this.uiType=null;this.view=null;this.isInit=false;this.view=new viewCls;this.view.on(Laya.Event.ADDED,this,this.onAdd)}init(){}onAdd(event){if(!this.isInit){this.isInit=true;this.init()}this.view.on(Laya.Event.CLICK,this,this.mouseClick);this.view.on(Laya.Event.REMOVED,this,this.onRmove);ui.UIScaleManager.ins.regUI(this.uiType.name,()=>{this.scaleH()},()=>{this.scaleV()});this.open()}onRmove(event){this.view.off(Laya.Event.CLICK,this,this.mouseClick);this.view.off(Laya.Event.REMOVED,this,this.onRmove);ui.UIScaleManager.ins.regUI(this.uiType.name,null,null);this.close()}isOpen(){return this.view!=null&&this.view.parent!=null}open(){}scaleH(){}scaleV(){}mouseClick(event){let btn=event.target;if(btn instanceof Laya.Sprite){if(btn.name==""||btn instanceof BaseWindow||btn instanceof Laya.Box||btn instanceof Laya.ProgressBar||btn instanceof Laya.ScrollBar||btn instanceof Laya.Slider||btn instanceof Laya.ComboBox){}else{if(btn instanceof Laya.Button){Laya.Tween.from(btn,{scaleX:.8,scaleY:.8},80)}this.viewClick(btn)}}}viewClick(sp){let spName=sp.name;switch(spName){case"btnClose":ui.UIManager.ins.closeWindow(this.uiType);break;default:break}}close(){}}ui.BaseWindow=BaseWindow})(ui=game.ui||(game.ui={}))})(game||(game={}));var game;(function(game){var LangType=game.platform.LangType;var ScreenFillType=game.scene.ScreenFillType;class Define{constructor(){}}Define.isDebug=true;Define.DeviceW=720;Define.DeviceH=1280;Define.CDN="res";Define.serverHttp="http://127.0.0.1";Define.serverIP="http://127.0.0.1";Define.serverPort="3000";Define.serverConfigUrl="res/config/serverConfig.json";Define.gameId=1;Define.gameVersion="100";Define.langId=LangType.Zh;Define.isLocal=true;Define.isVertitalGame=true;Define.isVertitalState=true;Define.isSameScale=false;Define.isSameBackgroundScale=true;Define.screenFillType=ScreenFillType.default;Define.appId="wx659ae0df220d382f";Define.SOUND_BTN="";Define.SOUND_MAIN=null;Define.DOWNLOAD_URL="";Define.BACKGROUND_COLOR="";game.Define=Define;class AdConfig{constructor(){}}game.AdConfig=AdConfig})(game||(game={}));var game;(function(game){var PlatformID=game.platform.PlatformID;class Global{constructor(){}}Global.platformId=PlatformID.None;game.Global=Global})(game||(game={}));console.log("game.core version: 2019-06-10 2.0.0");var Define=game.Define;var Global=game.Global;Global;var BaseUI=game.ui.BaseUI;var BaseWindow=game.ui.BaseWindow;var UIManager=game.ui.UIManager;var UIScaleManager=game.ui.UIScaleManager;var UIType=game.ui.UIType;var BaseFrame=game.ui.BaseFrame;var LayerManager=game.scene.LayerManager;var LayerName=game.scene.LayerName;var SceneManager=game.scene.SceneManager;var Scene3DManager=game.scene.Scene3DManager;var ScreenFillType=game.scene.ScreenFillType;var MathUtil=game.util.MathUtil;var PubUtil=game.util.PubUtil;var Dictionary=game.util.Dictionary;var EventManager=game.common.EventManager;var NoticeEvent=game.common.NoticeEvent;var ResManager=game.common.ResManager;var SoundManager=game.common.SoundManager;var TipManager=game.common.TipManager;var OpenManager=game.common.OpenManager;var TouchManager=game.common.TouchManager;var SwipeDirection=game.common.SwipeDirection;var TweenManager=game.common.TweenManager;var TweenTarget=game.common.TweenTarget;var TweenProp=game.common.TweenProp;var TweenPropType=game.common.TweenPropType;var BaseKing=game.king.BaseKing;var SkinData=game.king.SkinData;var Action=game.king.Action;var KingManager=game.king.KingManager;var ActionType=game.king.ActionType;var ActionState=game.king.ActionState;var BaseBone=game.king.BaseBone;var BoneManager=game.king.BoneManager;var PlatformManager=game.platform.PlatformManager;var PlatformID=game.platform.PlatformID;var LangType=game.platform.LangType;var PlatformAction=game.platform.PlatformAction;var LocalPlatform=game.platform.LocalPlatform;var WxPlatform=game.platform.WxPlatform;var FaceBookPlatform=game.platform.FaceBookPlatform;var ApplovinPlatform=game.platform.ApplovinPlatform;var IronSourcePlatform=game.platform.IronSourcePlatform;var MTGPlatform=game.platform.MTGPlatform;var NetManager=game.net.NetManager;var SocketIoEvent=game.net.SocketIoEvent;var HttpManager=game.net.HttpManager;var Base64Manager=game.base64.Base64Manager;var Base64Type=game.base64.Base64Type;var Stage=Laya.Stage;var Render=Laya.Render;var Sprite=Laya.Sprite;var EventData=Laya.EventData;var Skeleton=Laya.Skeleton;var Templet=Laya.Templet;var Browser=Laya.Browser;var Stat=Laya.Stat;var Tween=Laya.Tween;var WebGL=Laya.WebGL;